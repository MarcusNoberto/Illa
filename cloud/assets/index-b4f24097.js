import{n as m,j as e,H as P,B as O,F as N,S as F,r as G,I as re,P as oe}from"./@illa-design-764f0835.js";import{L as ne}from"./index-79a069ed.js";import{A as B,c as se,h as ie,t as ce,e as pe,a as le,S as de,b as me,d as he,f as ue,g as ge,i as Ae,l as ye,u as Ce,j as W,k as L,M as Se,T as H,D as fe,m as Pe,P as be,n as E}from"./hook-38a84d58.js";import{F as D,Q as we,A as Ee,H as x,I as $,u as b,G as R,R as w,N as k,U as v,S as ke,g as ve,T as _e,V as Te}from"./index-fd774fd8.js";import{i as V,L as Ie,r as Ne}from"./react-bc846394.js";import{b as j,d as X,a as _,c as U,A as z}from"./index-066ed609.js";import{F as Y}from"./index-4370180f.js";import{a as T}from"./@emotion-09d14760.js";import"./interface-8df5fe4c.js";import"./index-eab177f8.js";import"./utils-d5d7ac1c.js";import"./style-00a92373.js";import"./upstash-e9b235a2.js";import"./index.esm-11ba4214.js";import"./lodash-lib-cfb0e9ed.js";const xe=a=>{const{appName:t,appActivity:s,appDeployed:i,appID:h,description:S,publishedToMarketplace:d,editorInfo:u,appType:y=B.PC,cardType:g}=a,{t:r}=D(),{teamIdentifier:l}=V();return m("div",{css:se,children:[m("header",{css:ie,children:[e("h6",{css:ce,children:t}),e("p",{css:pe,children:r("dashboard.app.edited_time",{time:we(s.modifiedAt),user:s.modifier})}),m("div",{css:le,children:[i?e(P,{colorScheme:"green",size:"small",children:r("new_dashboard.status.deployed")}):e(P,{colorScheme:"grayBlue",size:"small",children:r("new_dashboard.status.undeploy")}),g==="app"&&y===B.MOBILE?e(P,{colorScheme:"grayBlue",size:"small",icon:e(de,{}),children:r("new_dashboard.type.mobile")}):e(P,{colorScheme:"grayBlue",size:"small",icon:e(me,{}),children:r("new_dashboard.type.desktop")}),d&&e(P,{size:"small",colorScheme:"techPurple",children:r("dashboard.common.marketplace")})]})]}),e("p",{css:he,children:S||r("new_dashboard.desc.no_description")}),m("footer",{css:ue,children:[e("div",{css:ge,children:u==null?void 0:u.map(C=>e(Ee,{size:24,css:Ae,avatarUrl:C.avatar,name:C.nickname,id:C.userID},C.userID))}),g==="app"&&e(Ie,{to:`${x(window.customDomain)}/${l}/deploy/app/${h}?token=${$()}`,target:"_blank",css:ye,children:e(O,{colorScheme:"grayBlue",variant:"outline",size:"large",w:"100%",children:r("dashboard.common.launch")})})]})]})},q=a=>{const t=b(R);return Ce(["/apps",t==null?void 0:t.id,a],([s,i])=>a?w({url:s,method:"GET"},{teamID:i}).then(h=>h.data):[])},$e=(a,t)=>w({url:`/apps/${a}`,method:"DELETE"},{teamID:t}),De=(a,t,s)=>w({url:`/apps/${a}/duplication`,method:"POST",data:{appName:t}},{teamID:s}).then(i=>i.data),Re=async(a,t,s)=>w({method:"PATCH",url:`/apps/${a}/config`,data:s},{teamID:t}).then(i=>i.data),Me=(a,t)=>w({url:"/apps",method:"POST",data:a},{teamID:t}),Be=T`
  display: grid;
  grid-template-columns: 1;
  grid-gap: 24px 24px;
  overflow: auto;
  padding: 0 16px;
  width: 100%;
  padding-bottom: 24px;
`,Ue=T`
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
`,ze=()=>{const a=b(R),t=j((a==null?void 0:a.myRole)??v.VIEWER,_.APP,k(a),X.VIEW),{data:s=[],isLoading:i}=q(t),{t:h}=D(),S=s.filter(r=>r.deployed),[d,u]=W(S??[],["appName","config.description"]),[y,g]=L();return m("div",{css:Ue,children:[e(Se,{titleName:h("page.workspace.menu.apps"),actionGroupComponent:e(N,{children:e(F,{size:"large",colorScheme:"techPurple",onChange:u,placeholder:h("dashboard.search"),allowClear:!0})})}),i?e(Y,{}):d.length>0?m(N,{children:[y&&e(G,{direction:"horizontal"}),e("div",{css:Be,onScroll:g,children:d.map(r=>e(xe,{appName:r.appName,description:r.config.description,appDeployed:r.deployed,appActivity:r.appActivity,appID:r.appId,publishedToMarketplace:r.config.publishedToMarketplace,editorInfo:r.editedBy,cardType:"app"},r.appId))})]}):e(H,{loading:!1,showCreate:!1})]})},Oe=T`
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
  grid-gap: 24px 24px;
  overflow: auto;
  padding: 0 32px;
  padding-bottom: 32px;
`,Fe=T`
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
`,Ge=128,Q=" Copy",We=Ge-Q.length,Le=(a="")=>`${(a||"").slice(0,We)}${Q}`,He=()=>{const a=b(ke),t=b(R),s=b(ve),i=j((t==null?void 0:t.myRole)??v.VIEWER,_.APP,k(t),X.VIEW),{data:h,isLoading:S}=q(i),{t:d}=D(),[u,y]=Ne.useState(!1),{teamIdentifier:g}=V(),r=re(),[l,C]=W(h??[],["appName","config.description"]),[J,K]=L(),Z=()=>{E(["/apps",a])},ee=n=>E(["/apps",a,i],async c=>{const o=await $e(n,a);return Array.isArray(c)?c.filter(p=>p.appId!==o.data.appID):c},{optimisticData:c=>(c==null?void 0:c.filter(o=>o.appId!==n))??[],rollbackOnError(c){return c instanceof Error?c.name!=="AbortError":!0}}),ae=n=>E(["/apps",a,i],async()=>{if(Array.isArray(l)){const A=l==null?void 0:l.find(p=>p.appId===n);if(!A)return;const c=Le(A.appName),o=await De(n,c,a);return window.open(`${x()}/${g}/app/${o.appId}?token=${$()}`,"_blank"),[o,...l]}return l}),te=(n,A)=>{const c={optimisticData:o=>{const p=o==null?void 0:o.find(f=>f.appId===n);if(!p)return o??[];const I=(o==null?void 0:o.filter(f=>f.appId!==n))??[];return[{...p,appName:A.appName??p.appName,config:{...p.config,...A}},...I]},rollbackOnError(o){return o instanceof Error?o.name!=="AbortError":!0},populateCache:(o,p)=>{const I=(p==null?void 0:p.filter(f=>f.appId!==n))??[];return[o,...I]},revalidate:!1};return E(["/apps",a,i],Re(n,a,A),c)},M=async()=>{y(!0);try{const n=await Me({appName:"Untitled app",initScheme:_e},a);Te("create_app",s==null?void 0:s.userID),Z(),window.open(`${x()}/${g}/app/${n.data.appId}?token=${$()}`,"_blank")}catch{r.error({content:d("create_fail")})}finally{y(!1)}};return m("div",{css:Fe,children:[e(fe,{titleName:d("page.workspace.menu.apps"),actionGroupComponent:m(N,{children:[e(F,{w:"200px",size:"large",colorScheme:"techPurple",onChange:C,placeholder:d("dashboard.search"),allowClear:!0}),U((t==null?void 0:t.myRole)??v.GUEST,_.APP,k(t),z.CREATE_APP)&&e(O,{size:"large",colorScheme:"techPurple",leftIcon:e(oe,{}),w:"200px",loading:u,onClick:M,children:d("new_dashboard.button.blank")})]})}),S?e(Y,{}):l.length>0?m(Pe,{deleteApp:ee,copyApp:ae,updateAppConfig:te,children:[J&&e(G,{direction:"horizontal"}),e("div",{css:Oe,onScroll:K,children:l.map(n=>e(be,{appInfo:n},n.appId))})]}):e(H,{loading:u,onClickButton:M,showCreate:U((t==null?void 0:t.myRole)??v.GUEST,_.APP,k(t),z.CREATE_APP)})]})},sa=()=>e(ne,{desktopPage:e(He,{}),mobilePage:e(ze,{})});export{He as PCAppWorkspace,sa as default};
//# sourceMappingURL=index-b4f24097.js.map
