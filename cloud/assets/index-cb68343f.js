import{F as M,T as ne,A as se,H as $,I as D,u as b,G as B,V as E,P as _,U as T,K as w,J as r,S as R,W as ie,g as ce,X as pe,Y as le}from"./index-1d3dcc29.js";import{L as de}from"./index-60ddec07.js";import{A as z,c as me,h as he,t as ue,e as ge,a as Ae,S as ye,b as Ce,d as Se,f as fe,g as Pe,i as be,l as we,u as Ee,j as F,k as W,M as ke,T as L,D as ve,m as _e,P as Te,n as k}from"./hook-7c014986.js";import{q as v,k as p,K as P,B as j,S as H,y as V,N as xe,P as Ie}from"./@illa-design-df878cb8.js";import{i as X,L as Ne,r as $e}from"./react-bc846394.js";import{b as Y,d as q,a as x,c as O,A as G}from"./index-356d5fb7.js";import{F as K}from"./index-7ce90634.js";import{e as I}from"./@emotion-28b7fe46.js";import"./interface-8df5fe4c.js";import"./index-1e58851c.js";import"./utils-89abc4eb.js";import"./style-56e482f1.js";import"./upstash-7245fd7f.js";import"./index.esm-11ba4214.js";import"./lodash-lib-cfb0e9ed.js";const De=e=>{const{appName:a,appActivity:s,appDeployed:i,appID:h,description:S,publishedToMarketplace:m,editorInfo:u,appType:y=z.PC,cardType:g}=e,{t}=M(),{teamIdentifier:d}=X();return v("div",{css:me,children:[v("header",{css:he,children:[p("h6",{css:ue,children:a}),p("p",{css:ge,children:t("dashboard.app.edited_time",{time:ne(s.modifiedAt),user:s.modifier})}),v("div",{css:Ae,children:[i?p(P,{colorScheme:"green",size:"small",children:t("new_dashboard.status.deployed")}):p(P,{colorScheme:"grayBlue",size:"small",children:t("new_dashboard.status.undeploy")}),g==="app"&&y===z.MOBILE?p(P,{colorScheme:"grayBlue",size:"small",icon:p(ye,{}),children:t("new_dashboard.type.mobile")}):p(P,{colorScheme:"grayBlue",size:"small",icon:p(Ce,{}),children:t("new_dashboard.type.desktop")}),m&&p(P,{size:"small",colorScheme:"techPurple",children:t("dashboard.common.marketplace")})]})]}),p("p",{css:Se,children:S||t("new_dashboard.desc.no_description")}),v("footer",{css:fe,children:[p("div",{css:Pe,children:u==null?void 0:u.map(C=>p(se,{size:24,css:be,avatarUrl:C.avatar,name:C.nickname,id:C.userID},C.userID))}),g==="app"&&p(Ne,{to:`${$(window.customDomain)}/${d}/deploy/app/${h}?token=${D()}`,target:"_blank",css:we,children:p(j,{colorScheme:"grayBlue",variant:"outline",size:"large",w:"100%",children:t("dashboard.common.launch")})})]})]})},J=e=>{const a=b(B);return Ee(["/apps",a==null?void 0:a.id,e],([s,i])=>e?E({url:s,method:"GET"},{teamID:i}).then(h=>h.data):[])},Re=(e,a)=>E({url:`/apps/${e}`,method:"DELETE"},{teamID:a}),Me=(e,a,s)=>E({url:`/apps/${e}/duplication`,method:"POST",data:{appName:a}},{teamID:s}).then(i=>i.data),Be=async(e,a,s)=>E({method:"PATCH",url:`/apps/${e}/config`,data:s},{teamID:a}).then(i=>i.data),Ue=(e,a)=>E({url:"/apps",method:"POST",data:e},{teamID:a}),ze=I`
  display: grid;
  grid-template-columns: 1;
  grid-gap: 24px 24px;
  overflow: auto;
  padding: 0 16px;
  width: 100%;
  padding-bottom: 24px;
`,Oe=I`
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
`,Ge=()=>{const e=b(B),a=Y((e==null?void 0:e.myRole)??T.VIEWER,x.APP,_(e),q.VIEW),{data:s=[],isLoading:i}=J(a),{t:h}=M(),S=s.filter(t=>t.deployed),[m,u]=F(S??[],["appName","config.description"]),[y,g]=W();return w("div",{css:Oe,children:[r(ke,{titleName:h("page.workspace.menu.apps"),actionGroupComponent:r(R,{children:r(H,{size:"large",colorScheme:"techPurple",onChange:u,placeholder:h("dashboard.search"),allowClear:!0})})}),i?r(K,{}):m.length>0?w(R,{children:[y&&r(V,{direction:"horizontal"}),r("div",{css:ze,onScroll:g,children:m.map(t=>r(De,{appName:t.appName,description:t.config.description,appDeployed:t.deployed,appActivity:t.appActivity,appID:t.appId,publishedToMarketplace:t.config.publishedToMarketplace,editorInfo:t.editedBy,cardType:"app"},t.appId))})]}):r(L,{loading:!1,showCreate:!1})]})},Fe=I`
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
  grid-gap: 24px 24px;
  overflow: auto;
  padding: 0 32px;
  padding-bottom: 32px;
`,We=I`
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
`,Le=128,Q=" Copy",je=Le-Q.length,He=(e="")=>`${(e||"").slice(0,je)}${Q}`,Ve=()=>{const e=b(ie),a=b(B),s=b(ce),i=Y((a==null?void 0:a.myRole)??T.VIEWER,x.APP,_(a),q.VIEW),{data:h,isLoading:S}=J(i),{t:m}=M(),[u,y]=$e.useState(!1),{teamIdentifier:g}=X(),t=xe(),[d,C]=F(h??[],["appName","config.description"]),[Z,ee]=W(),ae=()=>{k(["/apps",e])},te=n=>k(["/apps",e,i],async c=>{const o=await Re(n,e);return Array.isArray(c)?c.filter(l=>l.appId!==o.data.appID):c},{optimisticData:c=>(c==null?void 0:c.filter(o=>o.appId!==n))??[],rollbackOnError(c){return c instanceof Error?c.name!=="AbortError":!0}}),re=n=>k(["/apps",e,i],async()=>{if(Array.isArray(d)){const A=d==null?void 0:d.find(l=>l.appId===n);if(!A)return;const c=He(A.appName),o=await Me(n,c,e);return window.open(`${$()}/${g}/app/${o.appId}?token=${D()}`,"_blank"),[o,...d]}return d}),oe=(n,A)=>{const c={optimisticData:o=>{const l=o==null?void 0:o.find(f=>f.appId===n);if(!l)return o??[];const N=(o==null?void 0:o.filter(f=>f.appId!==n))??[];return[{...l,appName:A.appName??l.appName,config:{...l.config,...A}},...N]},rollbackOnError(o){return o instanceof Error?o.name!=="AbortError":!0},populateCache:(o,l)=>{const N=(l==null?void 0:l.filter(f=>f.appId!==n))??[];return[o,...N]},revalidate:!1};return k(["/apps",e,i],Be(n,e,A),c)},U=async()=>{y(!0);try{const n=await Ue({appName:"Untitled app",initScheme:pe},e);le("create_app",s==null?void 0:s.userID),ae(),window.open(`${$()}/${g}/app/${n.data.appId}?token=${D()}`,"_blank")}catch{t.error({content:m("create_fail")})}finally{y(!1)}};return w("div",{css:We,children:[r(ve,{titleName:m("page.workspace.menu.apps"),actionGroupComponent:w(R,{children:[r(H,{w:"200px",size:"large",colorScheme:"techPurple",onChange:C,placeholder:m("dashboard.search"),allowClear:!0}),O((a==null?void 0:a.myRole)??T.GUEST,x.APP,_(a),G.CREATE_APP)&&r(j,{size:"large",colorScheme:"techPurple",leftIcon:r(Ie,{}),w:"200px",loading:u,onClick:U,children:m("new_dashboard.button.blank")})]})}),S?r(K,{}):d.length>0?w(_e,{deleteApp:te,copyApp:re,updateAppConfig:oe,children:[Z&&r(V,{direction:"horizontal"}),r("div",{css:Fe,onScroll:ee,children:d.map(n=>r(Te,{appInfo:n},n.appId))})]}):r(L,{loading:u,onClickButton:U,showCreate:O((a==null?void 0:a.myRole)??T.GUEST,x.APP,_(a),G.CREATE_APP)})]})},ca=()=>r(de,{desktopPage:r(Ve,{}),mobilePage:r(Ge,{})});export{Ve as PCAppWorkspace,ca as default};
//# sourceMappingURL=index-cb68343f.js.map
