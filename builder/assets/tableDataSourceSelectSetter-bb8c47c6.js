import{k as E}from"./@illa-design-402f214a.js";import{r as t}from"./react-9b7e00e3.js";import{b as y,d1 as P,cj as K,dO as R,d5 as F,di as N,h1 as M,h2 as Y,gY as $,eI as j}from"./index-2f1869ab.js";import{B as q}from"./baseDynamicSelect-34bff5ed.js";import{g as f,i as w}from"./lodash-lib-6e94956b.js";import"./@emotion-4f16718e.js";import"./codeMirror-vendor-eff8ab8d.js";import"./react-icons-vendor-2430ea65.js";import"./index-9dcf4ab8.js";import"./index-65ed348a.js";import"./index-e7294a86.js";import"./clsx.m-925abe8b.js";import"./clsx.m-266f4de0.js";import"./index-388caa78.js";import"./style-f1ef1d8c.js";import"./style-ab05d1ea.js";import"./index-323e87cb.js";const V=C=>{const{widgetDisplayName:d,labelName:k,labelDesc:I,detailedDescription:T,handleUpdateDsl:i,handleUpdateMultiAttrDSL:o}=C,h=y(P),p=y(K),b=y(R),O=t.useMemo(()=>{var e;return((e=b[`${d}.dataSource`]??[])==null?void 0:e.length)>0},[b,d]),s=y(e=>{var a;return((a=F(d,e))==null?void 0:a.props)||{}}),c=t.useMemo(()=>f(s,"columns",[]),[s]),x=t.useMemo(()=>c.filter(e=>e.custom),[c]),m=t.useMemo(()=>f(s,"dataSourceMode","select")==="dynamic",[s]),n=t.useMemo(()=>m?f(s,"dataSourceJS",[]):f(s,"dataSource",[]),[m,s]);t.useEffect(()=>{const e=[],a={};c==null||c.forEach(l=>{a[l.accessorKey]=l,e.push(l.accessorKey)});let r;try{r=N("",n,p)}catch{}if(!Array.isArray(r))return;const u=M(r,a,e);u!=null&&u.length&&!w(u,c)&&(o==null||o({columns:u}))},[c,p,n,o]);const g=t.useMemo(()=>h.map(e=>({label:e.displayName,value:`{{${e.displayName}.data}}`})),[h]),B=t.useCallback(()=>{const e=g.some(a=>a.value===n);m?(i("dataSourceMode","select"),e?i("dataSource",n):i("dataSource","")):(i("dataSourceMode","dynamic"),e&&i("dataSourceJS",n))},[i,m,g,n]),S=t.useCallback(e=>{const a=N("",e,p);if(Array.isArray(a)){let r=Y(a);if(r!=null&&r.length)return r.concat(x.map((u,l)=>({...u,columnIndex:r.length+l})))}},[x,p]),D=t.useCallback(e=>{const a=S(e);if(a){o==null||o({columns:a,dataSourceJS:e});return}o==null||o({dataSourceJS:e})},[S,o]),J=t.useCallback(e=>{const a=S(e);if(a){o==null||o({columns:a,dataSource:e});return}o==null||o({dataSource:e})},[S,o]);return E("div",{css:$,children:E(q,{...C,isDynamic:m,onClickFxButton:B,selectPlaceholder:"Select a query or transformer",inputPlaceholder:"{{}}",onChangeInput:D,path:`${d}.dataSourceJS`,options:g,expectedType:j.ARRAY,onChangeSelect:J,value:n,labelName:k,labelDesc:I,detailedDescription:T,isError:O})})};V.displayName="TableDataSourceSelectSetter";export{V as default};
//# sourceMappingURL=tableDataSourceSelectSetter-bb8c47c6.js.map
