{"version":3,"file":"modal-a5e6e9ee.js","sources":["../../src/widgetLibrary/ModalWidget/style.ts","../../src/widgetLibrary/ModalWidget/modal.tsx"],"sourcesContent":["import { css } from \"@emotion/react\"\nimport { globalColor, illaPrefix } from \"@illa-design/react\"\n\nexport const formContainerStyle = css`\n  width: 100%;\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n  position: relative;\n  overflow: hidden;\n`\n\nexport const formHeaderStyle = css`\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n`\nexport const formBodyStyle = css`\n  width: 100%;\n  height: 100%;\n  min-height: 100px;\n  flex: 1;\n  overflow-y: auto;\n  position: relative;\n`\nexport const resizeLineStyle = css`\n  width: 100%;\n  height: 100%;\n  cursor: row-resize;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n`\n\nexport const resizeBarStyle = css`\n  fill: ${globalColor(`--${illaPrefix}-white-01`)};\n  stroke: ${globalColor(`--${illaPrefix}-techPurple-03`)};\n  :hover {\n    fill: ${globalColor(`--${illaPrefix}-techPurple-03`)};\n    stroke: ${globalColor(`--${illaPrefix}-white-01`)};\n  }\n  :active {\n    fill: ${globalColor(`--${illaPrefix}-techPurple-03`)};\n    stroke: ${globalColor(`--${illaPrefix}-white-01`)};\n  }\n`\n","import { Resizable, ResizeCallback, ResizeStartCallback } from \"re-resizable\"\nimport {\n  FC,\n  MutableRefObject,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from \"react\"\nimport { useDrop } from \"react-dnd\"\nimport { useDispatch, useSelector } from \"react-redux\"\nimport useMeasure from \"react-use-measure\"\nimport ResizeBar from \"@/assets/resizeBar.svg?react\"\nimport { DropResultInfo } from \"@/page/App/components/DotPanel/components/Canvas/interface\"\nimport { UNIT_HEIGHT } from \"@/page/App/components/DotPanel/constant/canvas\"\nimport { DragInfo } from \"@/page/App/components/ScaleSquare/components/DragContainer/interface\"\nimport {\n  applyDashedLineStyle,\n  applyXDirectionDashedLineStyle,\n} from \"@/page/App/components/ScaleSquare/style\"\nimport { getIsILLAEditMode } from \"@/redux/config/configSelector\"\nimport { configActions } from \"@/redux/config/configSlice\"\nimport RenderChildrenCanvas from \"../PublicSector/RenderChildrenCanvas\"\nimport { ModalWidgetProps } from \"./interface\"\nimport {\n  formBodyStyle,\n  formContainerStyle,\n  formHeaderStyle,\n  resizeBarStyle,\n  resizeLineStyle,\n} from \"./style\"\nimport {\n  MODAL_BODY_MARGIN,\n  MODAL_BODY_MIN_HEIGHT,\n  MODAL_MIN_FOOTER_HEIGHT_ROW_NUMBER,\n  MODAL_MIN_HEADER_HEIGHT_ROW_NUMBER,\n} from \"./widgetConfig\"\n\ninterface DragCollection {\n  isDraggingActive: boolean\n}\n\nexport const ModalWidget: FC<ModalWidgetProps> = (props) => {\n  const {\n    childrenNode,\n    showFooter,\n    showHeader,\n    headerHeight,\n    footerHeight,\n    isVisible,\n    columnNumber,\n    displayName,\n    handleUpdateOriginalDSLMultiAttr,\n    triggerEventHandler,\n  } = props\n\n  const prevVisible = useRef<boolean>()\n  const isMount = useRef(false)\n  const dispatch = useDispatch()\n\n  useEffect(() => {\n    isMount.current = true\n\n    return () => {\n      isMount.current = false\n    }\n  }, [])\n\n  useEffect(() => {\n    if (isVisible && prevVisible.current !== isVisible && isMount.current) {\n      triggerEventHandler(\"onOpenModal\")\n      prevVisible.current = true\n    }\n\n    return () => {\n      if (isVisible && !isMount.current) {\n        triggerEventHandler(\"onCloseModal\")\n      }\n    }\n  }, [isVisible, triggerEventHandler])\n\n  const [containerRef, containerBounds] = useMeasure()\n  const containerNodeRef = useRef<HTMLDivElement>(\n    null,\n  ) as MutableRefObject<HTMLDivElement | null>\n  const [isMouseHover, setIsMouseHover] = useState(false)\n\n  const headerMinHeight = useMemo(\n    () => MODAL_MIN_HEADER_HEIGHT_ROW_NUMBER * UNIT_HEIGHT,\n    [],\n  )\n  const footerMinHeight = useMemo(\n    () => MODAL_MIN_FOOTER_HEIGHT_ROW_NUMBER * UNIT_HEIGHT,\n    [],\n  )\n\n  const headerMaxHeight = useMemo(() => {\n    return (\n      Math.floor(\n        (containerBounds.height -\n          (MODAL_BODY_MIN_HEIGHT + 2 * MODAL_BODY_MARGIN) -\n          footerHeight * UNIT_HEIGHT) /\n          UNIT_HEIGHT,\n      ) * UNIT_HEIGHT\n    )\n  }, [containerBounds.height, footerHeight])\n\n  const footerMaxHeight = useMemo(() => {\n    return (\n      Math.floor(\n        (containerBounds.height -\n          (MODAL_BODY_MIN_HEIGHT + 2 * MODAL_BODY_MARGIN) -\n          headerHeight * UNIT_HEIGHT) /\n          UNIT_HEIGHT,\n      ) * UNIT_HEIGHT\n    )\n  }, [containerBounds.height, headerHeight])\n\n  const isEditMode = useSelector(getIsILLAEditMode)\n\n  const handleUpdateHeight = useCallback((_height: number) => {\n    // TODO: auto height\n  }, [])\n\n  const resizeTopHandler = useMemo(() => {\n    return {\n      bottom: (\n        <div css={resizeLineStyle}>\n          <ResizeBar css={resizeBarStyle} />\n        </div>\n      ),\n    }\n  }, [])\n\n  const resizeBottomHandler = useMemo(() => {\n    return {\n      top: (\n        <div css={resizeLineStyle}>\n          <ResizeBar css={resizeBarStyle} />\n        </div>\n      ),\n    }\n  }, [])\n\n  const handleResizeStart: ResizeStartCallback = (e) => {\n    e.preventDefault()\n    e.stopPropagation()\n    dispatch(\n      configActions.setResizingNodeIDsReducer([\n        `${displayName}-resize-modal-header`,\n      ]),\n    )\n  }\n\n  const handleOnResizeTopStop: ResizeCallback = useCallback(\n    (e, dir, elementRef, delta) => {\n      const { height } = delta\n      let finalHeight = Math.floor(\n        (headerHeight * UNIT_HEIGHT + height) / UNIT_HEIGHT,\n      )\n      if (finalHeight * UNIT_HEIGHT >= headerMaxHeight) {\n        finalHeight = Math.floor(headerMaxHeight / UNIT_HEIGHT)\n      }\n      handleUpdateOriginalDSLMultiAttr({\n        headerHeight: finalHeight,\n      })\n      dispatch(configActions.setResizingNodeIDsReducer([]))\n    },\n    [dispatch, handleUpdateOriginalDSLMultiAttr, headerHeight, headerMaxHeight],\n  )\n\n  const handleOnResizeBottomStop: ResizeCallback = useCallback(\n    (e, dir, elementRef, delta) => {\n      const { height } = delta\n      let finalHeight = Math.floor(\n        (footerHeight * UNIT_HEIGHT + height) / UNIT_HEIGHT,\n      )\n      if (finalHeight * UNIT_HEIGHT > footerMaxHeight) {\n        finalHeight = Math.floor(footerMaxHeight / UNIT_HEIGHT)\n      }\n      handleUpdateOriginalDSLMultiAttr({\n        footerHeight: finalHeight,\n      })\n      dispatch(configActions.setResizingNodeIDsReducer([]))\n    },\n    [dispatch, footerHeight, footerMaxHeight, handleUpdateOriginalDSLMultiAttr],\n  )\n\n  const [{ isDraggingActive }, dropRef] = useDrop<\n    DragInfo,\n    DropResultInfo,\n    DragCollection\n  >(\n    () => ({\n      accept: [\"components\"],\n      collect: (monitor) => {\n        return {\n          isDraggingActive: monitor.isOver(),\n        }\n      },\n    }),\n    [],\n  )\n\n  return (\n    <div\n      css={formContainerStyle}\n      ref={(node) => {\n        dropRef(node)\n        containerRef(node)\n        containerNodeRef.current = node\n      }}\n      onMouseEnter={() => {\n        setIsMouseHover(true)\n      }}\n      onMouseLeave={() => {\n        setIsMouseHover(false)\n      }}\n    >\n      {showHeader && (\n        <Resizable\n          size={{\n            width: \"100%\",\n            height: headerHeight * UNIT_HEIGHT,\n          }}\n          minHeight={headerMinHeight}\n          maxHeight={headerMaxHeight}\n          handleComponent={\n            isMouseHover && !isDraggingActive ? resizeTopHandler : undefined\n          }\n          enable={{\n            bottom: isEditMode,\n          }}\n          onResizeStart={handleResizeStart}\n          onResizeStop={handleOnResizeTopStop}\n        >\n          <div css={formHeaderStyle}>\n            <RenderChildrenCanvas\n              displayName={childrenNode[0]}\n              columnNumber={columnNumber}\n              handleUpdateHeight={handleUpdateHeight}\n            />\n          </div>\n          {isEditMode && isMouseHover && !isDraggingActive && (\n            <div css={applyDashedLineStyle(false, true, false)} />\n          )}\n        </Resizable>\n      )}\n      <div css={formBodyStyle}>\n        <RenderChildrenCanvas\n          displayName={childrenNode[1]}\n          columnNumber={columnNumber}\n          handleUpdateHeight={handleUpdateHeight}\n        />\n        {isEditMode && isMouseHover && !isDraggingActive && (\n          <div css={applyXDirectionDashedLineStyle(false, true, false)} />\n        )}\n      </div>\n      {showFooter && (\n        <Resizable\n          size={{\n            width: \"100%\",\n            height: footerHeight * UNIT_HEIGHT,\n          }}\n          minHeight={footerMinHeight}\n          maxHeight={footerMaxHeight}\n          handleComponent={\n            isMouseHover && !isDraggingActive ? resizeBottomHandler : undefined\n          }\n          enable={{\n            top: isEditMode,\n          }}\n          onResizeStart={handleResizeStart}\n          onResizeStop={handleOnResizeBottomStop}\n        >\n          <div css={formHeaderStyle}>\n            <RenderChildrenCanvas\n              displayName={childrenNode[2]}\n              columnNumber={columnNumber}\n              handleUpdateHeight={handleUpdateHeight}\n            />\n          </div>\n          {isEditMode && isMouseHover && !isDraggingActive && (\n            <div\n              css={applyDashedLineStyle(false, true, false, footerMaxHeight)}\n            />\n          )}\n        </Resizable>\n      )}\n    </div>\n  )\n}\n\nModalWidget.displayName = \"ModalWidget\"\nexport default ModalWidget\n"],"names":["formContainerStyle","css","formHeaderStyle","formBodyStyle","resizeLineStyle","resizeBarStyle","globalColor","illaPrefix","ModalWidget","props","childrenNode","showFooter","showHeader","headerHeight","footerHeight","isVisible","columnNumber","displayName","handleUpdateOriginalDSLMultiAttr","triggerEventHandler","prevVisible","useRef","isMount","dispatch","useDispatch","useEffect","containerRef","containerBounds","useMeasure","containerNodeRef","isMouseHover","setIsMouseHover","useState","headerMinHeight","useMemo","MODAL_MIN_HEADER_HEIGHT_ROW_NUMBER","UNIT_HEIGHT","footerMinHeight","MODAL_MIN_FOOTER_HEIGHT_ROW_NUMBER","headerMaxHeight","MODAL_BODY_MIN_HEIGHT","MODAL_BODY_MARGIN","footerMaxHeight","isEditMode","useSelector","getIsILLAEditMode","handleUpdateHeight","useCallback","_height","resizeTopHandler","jsx","ResizeBar","resizeBottomHandler","handleResizeStart","e","configActions","handleOnResizeTopStop","dir","elementRef","delta","height","finalHeight","handleOnResizeBottomStop","isDraggingActive","dropRef","useDrop","monitor","jsxs","node","Resizable","RenderChildrenCanvas","applyDashedLineStyle","applyXDirectionDashedLineStyle"],"mappings":"iqBAGO,MAAMA,GAAqBC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASrBC,EAAkBD;AAAA;AAAA;AAAA;AAAA,EAKlBE,GAAgBF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQhBG,EAAkBH;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EASlBI,EAAiBJ;AAAA,UACpBK,EAAY,KAAKC,CAAU,WAAW,CAAC;AAAA,YACrCD,EAAY,KAAKC,CAAU,gBAAgB,CAAC;AAAA;AAAA,YAE5CD,EAAY,KAAKC,CAAU,gBAAgB,CAAC;AAAA,cAC1CD,EAAY,KAAKC,CAAU,WAAW,CAAC;AAAA;AAAA;AAAA,YAGzCD,EAAY,KAAKC,CAAU,gBAAgB,CAAC;AAAA,cAC1CD,EAAY,KAAKC,CAAU,WAAW,CAAC;AAAA;AAAA,ECAxCC,GAAqCC,GAAU,CACpD,KAAA,CACJ,aAAAC,EACA,WAAAC,EACA,WAAAC,EACA,aAAAC,EACA,aAAAC,EACA,UAAAC,EACA,aAAAC,EACA,YAAAC,EACA,iCAAAC,EACA,oBAAAC,CACE,EAAAV,EAEEW,EAAcC,EAAAA,SACdC,EAAUD,SAAO,EAAK,EACtBE,EAAWC,KAEjBC,EAAAA,UAAU,KACRH,EAAQ,QAAU,GAEX,IAAM,CACXA,EAAQ,QAAU,EAAA,GAEnB,CAAE,CAAA,EAELG,EAAAA,UAAU,KACJV,GAAaK,EAAY,UAAYL,GAAaO,EAAQ,UAC5DH,EAAoB,aAAa,EACjCC,EAAY,QAAU,IAGjB,IAAM,CACPL,GAAa,CAACO,EAAQ,SACxBH,EAAoB,cAAc,CACpC,GAED,CAACJ,EAAWI,CAAmB,CAAC,EAEnC,KAAM,CAACO,EAAcC,CAAe,EAAIC,GAAW,EAC7CC,EAAmBR,EAAA,OACvB,IAAA,EAEI,CAACS,EAAcC,CAAe,EAAIC,WAAS,EAAK,EAEhDC,EAAkBC,EAAA,QACtB,IAAMC,GAAqCC,EAC3C,CAAC,CAAA,EAEGC,EAAkBH,EAAA,QACtB,IAAMI,GAAqCF,EAC3C,CAAC,CAAA,EAGGG,EAAkBL,EAAAA,QAAQ,IAE5B,KAAK,OACFP,EAAgB,QACda,EAAwB,EAAIC,GAC7B3B,EAAesB,GACfA,CACA,EAAAA,EAEL,CAACT,EAAgB,OAAQb,CAAY,CAAC,EAEnC4B,EAAkBR,EAAAA,QAAQ,IAE5B,KAAK,OACFP,EAAgB,QACda,EAAwB,EAAIC,GAC7B5B,EAAeuB,GACfA,CACA,EAAAA,EAEL,CAACT,EAAgB,OAAQd,CAAY,CAAC,EAEnC8B,EAAaC,GAAYC,EAAiB,EAE1CC,EAAqBC,cAAaC,GAAoB,CAE5D,EAAG,CAAE,CAAA,EAECC,EAAmBf,EAAAA,QAAQ,KACxB,CACL,SACG,MAAI,CAAA,IAAK9B,EACR,SAAC8C,EAAAC,EAAA,CAAU,IAAK9C,CAAA,CAAgB,CAClC,CAAA,CAAA,GAGH,CAAE,CAAA,EAEC+C,EAAsBlB,EAAAA,QAAQ,KAC3B,CACL,MACG,MAAI,CAAA,IAAK9B,EACR,SAAC8C,EAAAC,EAAA,CAAU,IAAK9C,CAAA,CAAgB,CAClC,CAAA,CAAA,GAGH,CAAE,CAAA,EAECgD,EAA0CC,GAAM,CACpDA,EAAE,eAAe,EACjBA,EAAE,gBAAgB,EAClB/B,EACEgC,EAAc,0BAA0B,CACtC,GAAGtC,CAAW,sBAAA,CACf,CAAA,CACH,EAGIuC,EAAwCT,EAAA,YAC5C,CAACO,EAAGG,EAAKC,GAAYC,IAAU,CACvB,KAAA,CAAE,OAAAC,CAAW,EAAAD,EACnB,IAAIE,EAAc,KAAK,OACpBhD,EAAeuB,EAAcwB,GAAUxB,CAAA,EAEtCyB,EAAczB,GAAeG,IACjBsB,EAAA,KAAK,MAAMtB,EAAkBH,CAAW,GAEvBlB,EAAA,CAC/B,aAAc2C,CAAA,CACf,EACDtC,EAASgC,EAAc,0BAA0B,CAAA,CAAE,CAAC,CACtD,EACA,CAAChC,EAAUL,EAAkCL,EAAc0B,CAAe,CAAA,EAGtEuB,EAA2Cf,EAAA,YAC/C,CAACO,EAAGG,EAAKC,GAAYC,IAAU,CACvB,KAAA,CAAE,OAAAC,CAAW,EAAAD,EACnB,IAAIE,EAAc,KAAK,OACpB/C,EAAesB,EAAcwB,GAAUxB,CAAA,EAEtCyB,EAAczB,EAAcM,IAChBmB,EAAA,KAAK,MAAMnB,EAAkBN,CAAW,GAEvBlB,EAAA,CAC/B,aAAc2C,CAAA,CACf,EACDtC,EAASgC,EAAc,0BAA0B,CAAA,CAAE,CAAC,CACtD,EACA,CAAChC,EAAUT,EAAc4B,EAAiBxB,CAAgC,CAAA,EAGtE,CAAC,CAAE,iBAAA6C,GAAoBC,CAAO,EAAIC,GAKtC,KAAO,CACL,OAAQ,CAAC,YAAY,EACrB,QAAUC,IACD,CACL,iBAAkBA,EAAQ,OAAO,CAAA,EAErC,GAEF,CAAC,CAAA,EAID,OAAAC,EAAC,MAAA,CACC,IAAKnE,GACL,IAAMoE,GAAS,CACbJ,EAAQI,CAAI,EACZ1C,EAAa0C,CAAI,EACjBvC,EAAiB,QAAUuC,CAC7B,EACA,aAAc,IAAM,CAClBrC,EAAgB,EAAI,CACtB,EACA,aAAc,IAAM,CAClBA,EAAgB,EAAK,CACvB,EAEC,SAAA,CACCnB,GAAAuD,EAACE,EAAA,CACC,KAAM,CACJ,MAAO,OACP,OAAQxD,EAAeuB,CACzB,EACA,UAAWH,EACX,UAAWM,EACX,gBACET,GAAgB,CAACiC,EAAmBd,EAAmB,OAEzD,OAAQ,CACN,OAAQN,CACV,EACA,cAAeU,EACf,aAAcG,EAEd,SAAA,CAACN,EAAA,MAAA,CAAI,IAAKhD,EACR,SAAAgD,EAACoB,EAAA,CACC,YAAa5D,EAAa,CAAC,EAC3B,aAAAM,EACA,mBAAA8B,CAAA,CAAA,EAEJ,EACCH,GAAcb,GAAgB,CAACiC,GAC9Bb,EAAC,MAAI,CAAA,IAAKqB,EAAqB,GAAO,GAAM,EAAK,CAAG,CAAA,CAAA,CAAA,CAExD,EAEFJ,EAAC,MAAI,CAAA,IAAKhE,GACR,SAAA,CAAA+C,EAACoB,EAAA,CACC,YAAa5D,EAAa,CAAC,EAC3B,aAAAM,EACA,mBAAA8B,CAAA,CACF,EACCH,GAAcb,GAAgB,CAACiC,GAC9Bb,EAAC,MAAI,CAAA,IAAKsB,GAA+B,GAAO,GAAM,EAAK,CAAG,CAAA,CAAA,EAElE,EACC7D,GACCwD,EAACE,EAAA,CACC,KAAM,CACJ,MAAO,OACP,OAAQvD,EAAesB,CACzB,EACA,UAAWC,EACX,UAAWK,EACX,gBACEZ,GAAgB,CAACiC,EAAmBX,EAAsB,OAE5D,OAAQ,CACN,IAAKT,CACP,EACA,cAAeU,EACf,aAAcS,EAEd,SAAA,CAACZ,EAAA,MAAA,CAAI,IAAKhD,EACR,SAAAgD,EAACoB,EAAA,CACC,YAAa5D,EAAa,CAAC,EAC3B,aAAAM,EACA,mBAAA8B,CAAA,CAAA,EAEJ,EACCH,GAAcb,GAAgB,CAACiC,GAC9Bb,EAAC,MAAA,CACC,IAAKqB,EAAqB,GAAO,GAAM,GAAO7B,CAAe,CAAA,CAC/D,CAAA,CAAA,CAEJ,CAAA,CAAA,CAAA,CAIR,EAEAlC,GAAY,YAAc"}