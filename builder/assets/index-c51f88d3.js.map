{"version":3,"file":"index-c51f88d3.js","sources":["../../../../packages/illa-public-component/ResourceGenerator/components/ConfigElements/GoogleSheetsConfigElement/style.ts","../../../../packages/illa-public-component/ResourceGenerator/components/ConfigElements/GoogleSheetsConfigElement/index.tsx"],"sourcesContent":["import { css } from \"@emotion/react\"\nimport { getColor } from \"@illa-design/react\"\n\nexport const oAuthStatusContainerStyle = css`\n  width: 100%;\n  padding: 8px 24px;\n`\n\nexport const getOAuthStatusContentStyle = (isSuccess: boolean) => css`\n  width: 100%;\n  padding: 9px 16px;\n  display: flex;\n  gap: 8px;\n  height: 40px;\n  background: ${isSuccess ? getColor(\"green\", \"08\") : getColor(\"orange\", \"08\")};\n  border-radius: 4px;\n  align-items: center;\n`\n\nexport const oAuthErrorIconStyle = css`\n  font-size: 16px;\n  color: ${getColor(\"orange\", \"03\")};\n`\n","import { GoogleSheetResourceInitial } from \"@illa-public/public-configs\"\nimport {\n  GoogleSheetAuthStatus,\n  GoogleSheetResource,\n} from \"@illa-public/public-types\"\nimport { TextLink } from \"@illa-public/text-link\"\nimport { FC, useCallback, useContext, useMemo } from \"react\"\nimport { useFormContext } from \"react-hook-form\"\nimport { Trans, useTranslation } from \"react-i18next\"\nimport { WarningCircleIcon } from \"@illa-design/react\"\nimport { ResourceGeneratorContext } from \"../../../provider\"\nimport { validateNotEmpty } from \"../../../utils\"\nimport { ControlledElement } from \"../../ControlledElement\"\nimport { ResourceDivider } from \"../../ResourceDivider\"\nimport { BaseConfigElementProps } from \"../interface\"\nimport { container } from \"../style\"\nimport {\n  getOAuthStatusContentStyle,\n  oAuthErrorIconStyle,\n  oAuthStatusContainerStyle,\n} from \"./style\"\n\nconst GoogleSheetsConfigElement: FC<BaseConfigElementProps> = (props) => {\n  const { resourceID } = props\n\n  const { control, watch } = useFormContext()\n\n  const { t } = useTranslation()\n  const { getResourceByID } = useContext(ResourceGeneratorContext)\n  const findResource = getResourceByID(resourceID)\n\n  const content = (findResource?.content ??\n    GoogleSheetResourceInitial) as GoogleSheetResource\n\n  const authenticationWatch = watch(\"authentication\", content.authentication)\n\n  const isOauthType = authenticationWatch === \"oauth2\"\n  // redirect authentication status\n  const isAuthenticated =\n    content.opts?.status === GoogleSheetAuthStatus.Authenticated\n\n  const showAuthStatus = content.opts?.status !== GoogleSheetAuthStatus.Initial\n\n  const handleLinkTo = useCallback(\n    (link: string) => () => {\n      window.open(link, \"_blank\")\n    },\n    [],\n  )\n\n  const oauthMethodOptions = useMemo(() => {\n    if (import.meta.env.ILLA_APP_ENV === \"production\") {\n      return [\n        {\n          label: t(\"editor.action.form.option.gs.service_account\"),\n          value: \"serviceAccount\",\n        },\n      ]\n    } else {\n      return [\n        {\n          label: t(\"editor.action.form.option.gs.service_account\"),\n          value: \"serviceAccount\",\n        },\n        {\n          label: t(\"editor.action.form.option.gs.oauth_2.0\"),\n          value: \"oauth2\",\n        },\n      ]\n    }\n  }, [t])\n\n  return (\n    <>\n      <div css={container}>\n        <ControlledElement\n          controlledType=\"input\"\n          isRequired\n          title={t(\"editor.action.resource.db.label.name\")}\n          control={control}\n          defaultValue={findResource?.resourceName ?? \"\"}\n          rules={[\n            {\n              validate: validateNotEmpty,\n            },\n          ]}\n          placeholders={[t(\"editor.action.resource.db.placeholder.name\")]}\n          name=\"resourceName\"\n          tips={t(\"editor.action.resource.restapi.tip.name\")}\n        />\n        <ResourceDivider type=\"General Option\" />\n        <ControlledElement\n          isRequired\n          title={t(\"editor.action.form.label.gs.authentication\")}\n          defaultValue={content.authentication}\n          name=\"authentication\"\n          controlledType=\"select\"\n          control={control}\n          options={oauthMethodOptions}\n        />\n        {isOauthType ? (\n          <ControlledElement\n            isRequired\n            title={t(\"editor.action.form.label.gs.access_type\")}\n            key=\"editor.action.form.label.gs.access_type\"\n            defaultValue={content.opts?.accessType ?? \"rw\"}\n            name=\"accessType\"\n            controlledType=\"radio\"\n            control={control}\n            options={[\n              {\n                label: t(\"editor.action.form.option.gs.read_and_write\"),\n                value: \"rw\",\n              },\n              {\n                label: t(\"editor.action.form.option.gs.read_only\"),\n                value: \"r\",\n              },\n            ]}\n          />\n        ) : (\n          <ControlledElement\n            title={t(\"editor.action.form.label.gs.private_key\")}\n            key=\"editor.action.form.label.gs.private_key\"\n            defaultValue={content.opts?.privateKey ?? \"\"}\n            name=\"privateKey\"\n            isRequired\n            rules={[\n              {\n                validate: validateNotEmpty,\n              },\n            ]}\n            controlledType=\"textarea\"\n            control={control}\n            placeholders={[t(\"editor.action.form.placeholder.gs.private_key\")]}\n            tips={\n              <Trans\n                i18nKey=\"editor.action.form.tips.gs.private_key\"\n                t={t}\n                components={[\n                  <TextLink\n                    key=\"editor.action.form.tips.gs.private_key.console\"\n                    onClick={handleLinkTo(\n                      \"https://console.cloud.google.com/cloud-resource-manager\",\n                    )}\n                  />,\n                  <TextLink\n                    key=\"editor.action.form.tips.gs.private_key.docs\"\n                    onClick={handleLinkTo(\n                      \"https://cloud.google.com/docs/authentication/getting-started\",\n                    )}\n                  />,\n                  <TextLink\n                    key=\"editor.action.form.tips.gs.private_key.limit\"\n                    onClick={handleLinkTo(\n                      \"https://developers.google.com/sheets/api/limits\",\n                    )}\n                  />,\n                ]}\n              />\n            }\n          />\n        )}\n        {showAuthStatus && (\n          <div css={oAuthStatusContainerStyle}>\n            <div css={getOAuthStatusContentStyle(isAuthenticated)}>\n              {!isAuthenticated ? (\n                <>\n                  <WarningCircleIcon css={oAuthErrorIconStyle} />\n                  <>{t(\"editor.action.form.tips.gs.failed_to_authentica\")}</>\n                </>\n              ) : (\n                <>{t(\"editor.action.form.tips.gs.successfully_authent\")}</>\n              )}\n            </div>\n          </div>\n        )}\n      </div>\n    </>\n  )\n}\nGoogleSheetsConfigElement.displayName = \"GoogleSheetsConfigElement\"\nexport default GoogleSheetsConfigElement\n"],"names":["oAuthStatusContainerStyle","css","getOAuthStatusContentStyle","isSuccess","getColor","oAuthErrorIconStyle","GoogleSheetsConfigElement","props","resourceID","control","watch","useFormContext","useTranslation","getResourceByID","useContext","ResourceGeneratorContext","findResource","content","GoogleSheetResourceInitial","isOauthType","isAuthenticated","_a","GoogleSheetAuthStatus","showAuthStatus","_b","handleLinkTo","useCallback","link","oauthMethodOptions","useMemo","jsx","Fragment","jsxs","container","ControlledElement","validateNotEmpty","ResourceDivider","_c","_d","Trans","TextLink","WarningCircleIcon"],"mappings":"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"}