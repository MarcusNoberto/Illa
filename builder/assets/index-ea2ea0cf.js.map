{"version":3,"file":"index-ea2ea0cf.js","sources":["../../src/page/App/components/InspectPanel/PanelSetters/InputSetter/ScriptInput/style.ts","../../src/page/App/components/InspectPanel/PanelSetters/InputSetter/ScriptInput/index.tsx"],"sourcesContent":["import { css } from \"@emotion/react\"\n\nexport const applyInputSetterWrapperStyle = css`\n  width: 100%;\n  padding: 8px 0;\n  display: flex;\n  flex-direction: column;\n  gap: 8px;\n`\n\nexport const docComponentContainerStyle = css`\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: flex-end;\n`\n","import { hasDynamicStringSnippet } from \"@illa-public/dynamic-string\"\nimport { ILLA_MIXPANEL_EVENT_TYPE } from \"@illa-public/mixpanel-utils\"\nimport { RUN_SCRIPT_DOC_LINK } from \"@illa-public/public-configs\"\nimport { FC, useCallback, useMemo } from \"react\"\nimport { useTranslation } from \"react-i18next\"\nimport { useSelector } from \"react-redux\"\nimport { Link } from \"react-router-dom\"\nimport { Button, DocsIcon } from \"@illa-design/react\"\nimport { CodeEditor } from \"@/components/CodeEditor\"\nimport {\n  CODE_LANG,\n  CODE_TYPE,\n} from \"@/components/CodeEditor/CodeMirror/extensions/interface\"\nimport {\n  getNeedComputedValueWithList,\n  realInputValueWithList,\n} from \"@/page/App/components/InspectPanel/PanelSetters/InputSetter/util\"\nimport { getContainerListDisplayNameMappedChildrenNodeDisplayName } from \"@/redux/currentApp/components/componentsSelector\"\nimport {\n  realInputValueWithScript,\n  wrapperScriptCode,\n} from \"@/utils/evaluateDynamicString/valueConverter\"\nimport { trackInEditor } from \"@/utils/mixpanelHelper\"\nimport { VALIDATION_TYPES } from \"@/utils/validationFactory\"\nimport { BaseInputSetterProps } from \"../interface\"\nimport {\n  applyInputSetterWrapperStyle,\n  docComponentContainerStyle,\n} from \"./style\"\n\nconst ScriptInput: FC<BaseInputSetterProps> = (props) => {\n  const {\n    className,\n    placeholder,\n    attrName,\n    handleUpdateDsl,\n    value,\n    widgetDisplayName,\n    labelName,\n    detailedDescription,\n    labelDesc,\n    widgetType,\n  } = props\n\n  const { t } = useTranslation()\n\n  const listWidgets = useSelector(\n    getContainerListDisplayNameMappedChildrenNodeDisplayName,\n  )\n\n  const currentListDisplayName = useMemo(() => {\n    const listWidgetDisplayNames = Object.keys(listWidgets)\n    for (let i = 0; i < listWidgetDisplayNames.length; i++) {\n      if (listWidgets[listWidgetDisplayNames[i]].includes(widgetDisplayName)) {\n        return listWidgetDisplayNames[i]\n      }\n    }\n    return \"\"\n  }, [listWidgets, widgetDisplayName])\n\n  const finalValue = useMemo(() => {\n    let tempValue = value\n    if (currentListDisplayName) {\n      tempValue = realInputValueWithList(value, currentListDisplayName)\n    }\n    return realInputValueWithScript(tempValue, true)\n  }, [currentListDisplayName, value])\n\n  const onChange = useCallback(\n    (value: string) => {\n      let output = value\n      if (\n        currentListDisplayName &&\n        hasDynamicStringSnippet(value ?? \"\") &&\n        value.includes(\"currentItem\")\n      ) {\n        output = getNeedComputedValueWithList(value, currentListDisplayName)\n      }\n      output = wrapperScriptCode(output, true)\n      handleUpdateDsl(attrName, output)\n    },\n    [attrName, currentListDisplayName, handleUpdateDsl],\n  )\n\n  const onFocus = useCallback(() => {\n    trackInEditor(ILLA_MIXPANEL_EVENT_TYPE.FOCUS, {\n      element: \"component_inspect_code_mirror\",\n      parameter1: widgetType,\n      parameter2: attrName,\n    })\n  }, [attrName, widgetType])\n\n  const onBlur = useCallback(\n    (value: string) => {\n      trackInEditor(ILLA_MIXPANEL_EVENT_TYPE.BLUR, {\n        element: \"component_inspect_code_mirror\",\n        parameter1: widgetType,\n        parameter2: attrName,\n        parameter3: value.length,\n      })\n    },\n    [attrName, widgetType],\n  )\n\n  return (\n    <div css={applyInputSetterWrapperStyle}>\n      <div css={docComponentContainerStyle}>\n        <Link to={RUN_SCRIPT_DOC_LINK} target=\"_blank\">\n          <Button\n            leftIcon={<DocsIcon />}\n            colorScheme=\"grayBlue\"\n            variant=\"text\"\n            size=\"small\"\n          >\n            {t(\"editor.inspect.header.action_menu.view_documentation\")}\n          </Button>\n        </Link>\n      </div>\n      <CodeEditor\n        scopeOfAutoComplete=\"page\"\n        className={className}\n        value={finalValue}\n        onChange={onChange}\n        showLineNumbers={false}\n        placeholder={placeholder}\n        expectValueType={VALIDATION_TYPES.STRING}\n        lang={CODE_LANG.JAVASCRIPT}\n        maxHeight=\"208px\"\n        minHeight=\"120px\"\n        maxWidth=\"100%\"\n        codeType={CODE_TYPE.FUNCTION}\n        modalTitle={labelName}\n        canShowCompleteInfo\n        modalDescription={detailedDescription ?? labelDesc}\n        onFocus={onFocus}\n        onBlur={onBlur}\n      />\n    </div>\n  )\n}\n\nScriptInput.displayName = \"BaseInput\"\nexport default ScriptInput\n"],"names":["applyInputSetterWrapperStyle","css","docComponentContainerStyle","ScriptInput","props","className","placeholder","attrName","handleUpdateDsl","value","widgetDisplayName","labelName","detailedDescription","labelDesc","widgetType","t","useTranslation","listWidgets","useSelector","getContainerListDisplayNameMappedChildrenNodeDisplayName","currentListDisplayName","useMemo","listWidgetDisplayNames","i","finalValue","tempValue","realInputValueWithList","realInputValueWithScript","onChange","useCallback","output","hasDynamicStringSnippet","getNeedComputedValueWithList","wrapperScriptCode","onFocus","trackInEditor","ILLA_MIXPANEL_EVENT_TYPE","onBlur","jsxs","jsx","Link","RUN_SCRIPT_DOC_LINK","Button","DocsIcon","CodeEditor","VALIDATION_TYPES","CODE_LANG","CODE_TYPE"],"mappings":"qnBAEO,MAAMA,EAA+BC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQ/BC,EAA6BD;AAAA;AAAA;AAAA;AAAA;AAAA,ECoBpCE,EAAyCC,GAAU,CACjD,KAAA,CACJ,UAAAC,EACA,YAAAC,EACA,SAAAC,EACA,gBAAAC,EACA,MAAAC,EACA,kBAAAC,EACA,UAAAC,EACA,oBAAAC,EACA,UAAAC,EACA,WAAAC,CACE,EAAAV,EAEE,CAAE,EAAAW,GAAMC,IAERC,EAAcC,EAClBC,CAAA,EAGIC,EAAyBC,EAAAA,QAAQ,IAAM,CACrC,MAAAC,EAAyB,OAAO,KAAKL,CAAW,EACtD,QAASM,EAAI,EAAGA,EAAID,EAAuB,OAAQC,IACjD,GAAIN,EAAYK,EAAuBC,CAAC,CAAC,EAAE,SAASb,CAAiB,EACnE,OAAOY,EAAuBC,CAAC,EAG5B,MAAA,EAAA,EACN,CAACN,EAAaP,CAAiB,CAAC,EAE7Bc,EAAaH,EAAAA,QAAQ,IAAM,CAC/B,IAAII,EAAYhB,EAChB,OAAIW,IACUK,EAAAC,EAAuBjB,EAAOW,CAAsB,GAE3DO,EAAyBF,EAAW,EAAI,CAAA,EAC9C,CAACL,EAAwBX,CAAK,CAAC,EAE5BmB,EAAWC,EAAA,YACdpB,GAAkB,CACjB,IAAIqB,EAASrB,EAEXW,GACAW,EAAwBtB,GAAS,EAAE,GACnCA,EAAM,SAAS,aAAa,IAEnBqB,EAAAE,EAA6BvB,EAAOW,CAAsB,GAE5DU,EAAAG,EAAkBH,EAAQ,EAAI,EACvCtB,EAAgBD,EAAUuB,CAAM,CAClC,EACA,CAACvB,EAAUa,EAAwBZ,CAAe,CAAA,EAG9C0B,EAAUL,EAAAA,YAAY,IAAM,CAChCM,EAAcC,EAAyB,MAAO,CAC5C,QAAS,gCACT,WAAYtB,EACZ,WAAYP,CAAA,CACb,CAAA,EACA,CAACA,EAAUO,CAAU,CAAC,EAEnBuB,EAASR,EAAA,YACZpB,GAAkB,CACjB0B,EAAcC,EAAyB,KAAM,CAC3C,QAAS,gCACT,WAAYtB,EACZ,WAAYP,EACZ,WAAYE,EAAM,MAAA,CACnB,CACH,EACA,CAACF,EAAUO,CAAU,CAAA,EAIrB,OAAAwB,EAAC,MAAI,CAAA,IAAKtC,EACR,SAAA,CAACuC,EAAA,MAAA,CAAI,IAAKrC,EACR,SAAAqC,EAACC,GAAK,GAAIC,EAAqB,OAAO,SACpC,SAAAF,EAACG,EAAA,CACC,WAAWC,EAAS,EAAA,EACpB,YAAY,WACZ,QAAQ,OACR,KAAK,QAEJ,WAAE,sDAAsD,CAAA,GAE7D,CACF,CAAA,EACAJ,EAACK,EAAA,CACC,oBAAoB,OACpB,UAAAvC,EACA,MAAOmB,EACP,SAAAI,EACA,gBAAiB,GACjB,YAAAtB,EACA,gBAAiBuC,EAAiB,OAClC,KAAMC,EAAU,WAChB,UAAU,QACV,UAAU,QACV,SAAS,OACT,SAAUC,EAAU,SACpB,WAAYpC,EACZ,oBAAmB,GACnB,iBAAkBC,GAAuBC,EACzC,QAAAqB,EACA,OAAAG,CAAA,CACF,CACF,CAAA,CAAA,CAEJ,EAEAlC,EAAY,YAAc"}