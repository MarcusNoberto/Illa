{"version":3,"file":"dateRange-57333418.js","sources":["../../src/widgetLibrary/DateRangeWidget/dateRange.tsx"],"sourcesContent":["import dayjs, { Dayjs } from \"dayjs\"\nimport { FC, useCallback, useEffect, useMemo } from \"react\"\nimport { RangeDatePicker } from \"@illa-design/react\"\nimport { AutoHeightContainer } from \"@/widgetLibrary/PublicSector/AutoHeightContainer\"\nimport { InvalidMessage } from \"@/widgetLibrary/PublicSector/InvalidMessage\"\nimport { Label } from \"@/widgetLibrary/PublicSector/Label\"\nimport { TooltipWrapper } from \"@/widgetLibrary/PublicSector/TooltipWrapper\"\nimport {\n  applyLabelAndComponentWrapperStyle,\n  applyValidateMessageWrapperStyle,\n} from \"@/widgetLibrary/PublicSector/TransformWidgetWrapper/style\"\nimport { handleValidateCheck } from \"../PublicSector/InvalidMessage/utils\"\nimport { DateWidgetProps, WrappedDateRangeProps } from \"./interface\"\n\nexport const WrappedDateRange: FC<WrappedDateRangeProps> = (props) => {\n  const {\n    startValue,\n    endValue,\n    dateFormat,\n    startPlaceholder,\n    endPlaceholder,\n    showClear,\n    minDate,\n    disabled,\n    maxDate,\n    colorScheme,\n    handleOnChange,\n    getValidateMessage,\n    handleUpdateMultiExecutionResult,\n    displayName,\n    readOnly,\n  } = props\n\n  const changeValue = (value?: string[]) => {\n    new Promise((resolve) => {\n      const startMessage = getValidateMessage(value?.[0])\n      const endMessage = getValidateMessage(value?.[1])\n      handleUpdateMultiExecutionResult([\n        {\n          displayName,\n          value: {\n            startValue: value?.[0] || \"\",\n            endValue: value?.[1] || \"\",\n            validateMessage: startMessage || endMessage,\n          },\n        },\n      ])\n      resolve(true)\n    }).then(() => {\n      handleOnChange?.()\n    })\n  }\n\n  const _placeholder = [startPlaceholder ?? \"\", endPlaceholder ?? \"\"]\n\n  const dateRangeValue = useMemo(() => {\n    return !startValue && !endValue ? undefined : [startValue, endValue]\n  }, [startValue, endValue])\n\n  const checkRange = useCallback(\n    (current?: Dayjs) => {\n      const beforeMinDate = minDate\n        ? !!current?.isBefore(dayjs(minDate))\n        : false\n      const afterMaxDate = maxDate ? !!current?.isAfter(dayjs(maxDate)) : false\n      return beforeMinDate || afterMaxDate\n    },\n    [minDate, maxDate],\n  )\n\n  return (\n    <RangeDatePicker\n      w=\"100%\"\n      editable={!readOnly}\n      colorScheme={colorScheme}\n      format={dateFormat}\n      value={dateRangeValue}\n      disabled={disabled}\n      placeholder={_placeholder}\n      allowClear={showClear}\n      disabledDate={checkRange}\n      onClear={() => {\n        changeValue([\"\", \"\"])\n      }}\n      onChange={changeValue}\n    />\n  )\n}\n\nWrappedDateRange.displayName = \"WrappedDateRange\"\n\nexport const DateRangeWidget: FC<DateWidgetProps> = (props) => {\n  const {\n    startValue,\n    endValue,\n    endPlaceholder,\n    updateComponentRuntimeProps,\n    deleteComponentRuntimeProps,\n    handleUpdateDsl,\n    labelPosition,\n    labelFull,\n    label,\n    labelAlign,\n    labelWidth = 33,\n    labelCaption,\n    labelWidthUnit,\n    required,\n    labelHidden,\n    tooltipText,\n    updateComponentHeight,\n    validateMessage,\n    customRule,\n    hideValidationMessage,\n    triggerEventHandler,\n  } = props\n\n  const getValidateMessage = useCallback(\n    (value?: unknown) => {\n      if (!hideValidationMessage) {\n        const message = handleValidateCheck({\n          value,\n          required,\n          customRule,\n        })\n        const showMessage = message && message.length > 0\n        return showMessage ? message : \"\"\n      }\n      return \"\"\n    },\n    [customRule, hideValidationMessage, required],\n  )\n\n  const handleValidate = useCallback(\n    (value?: unknown) => {\n      const message = getValidateMessage(value)\n      handleUpdateDsl({\n        validateMessage: message,\n      })\n      return message\n    },\n    [getValidateMessage, handleUpdateDsl],\n  )\n\n  useEffect(() => {\n    updateComponentRuntimeProps({\n      setStartValue: (startValue: string) => {\n        handleUpdateDsl({ startValue })\n      },\n      setEndValue: (endValue: string) => {\n        handleUpdateDsl({ endValue })\n      },\n      clearValue: () => {\n        handleUpdateDsl({ startValue: undefined, endValue: undefined })\n      },\n      validate: () => {\n        const startValueChecked = handleValidate(startValue)\n        if (startValueChecked) {\n          return startValueChecked\n        }\n        const endValueChecked = handleValidate(endValue)\n        if (endPlaceholder) {\n          return endValueChecked\n        }\n      },\n    })\n    return () => {\n      deleteComponentRuntimeProps()\n    }\n  }, [\n    deleteComponentRuntimeProps,\n    endPlaceholder,\n    endValue,\n    handleUpdateDsl,\n    handleValidate,\n    startValue,\n    updateComponentRuntimeProps,\n  ])\n\n  const handleOnChange = useCallback(() => {\n    triggerEventHandler(\"change\")\n  }, [triggerEventHandler])\n\n  return (\n    <AutoHeightContainer updateComponentHeight={updateComponentHeight}>\n      <TooltipWrapper tooltipText={tooltipText} tooltipDisabled={!tooltipText}>\n        <div css={applyLabelAndComponentWrapperStyle(labelPosition)}>\n          <Label\n            labelFull={labelFull}\n            label={label}\n            labelAlign={labelAlign}\n            labelWidth={labelWidth}\n            labelCaption={labelCaption}\n            labelWidthUnit={labelWidthUnit}\n            labelPosition={labelPosition}\n            required={required}\n            labelHidden={labelHidden}\n            hasTooltip={!!tooltipText}\n          />\n          <WrappedDateRange\n            {...props}\n            getValidateMessage={getValidateMessage}\n            handleOnChange={handleOnChange}\n          />\n        </div>\n      </TooltipWrapper>\n      {!hideValidationMessage && (\n        <div\n          css={applyValidateMessageWrapperStyle(\n            labelWidth,\n            labelPosition,\n            labelHidden || !label,\n          )}\n        >\n          <InvalidMessage validateMessage={validateMessage} />\n        </div>\n      )}\n    </AutoHeightContainer>\n  )\n}\nDateRangeWidget.displayName = \"DateRangeWidget\"\nexport default DateRangeWidget\n"],"names":["WrappedDateRange","props","startValue","endValue","dateFormat","startPlaceholder","endPlaceholder","showClear","minDate","disabled","maxDate","colorScheme","handleOnChange","getValidateMessage","handleUpdateMultiExecutionResult","displayName","readOnly","changeValue","value","resolve","startMessage","endMessage","_placeholder","dateRangeValue","useMemo","checkRange","useCallback","current","beforeMinDate","dayjs","afterMaxDate","jsx","RangeDatePicker","DateRangeWidget","updateComponentRuntimeProps","deleteComponentRuntimeProps","handleUpdateDsl","labelPosition","labelFull","label","labelAlign","labelWidth","labelCaption","labelWidthUnit","required","labelHidden","tooltipText","updateComponentHeight","validateMessage","customRule","hideValidationMessage","triggerEventHandler","message","handleValidateCheck","handleValidate","useEffect","startValueChecked","endValueChecked","jsxs","AutoHeightContainer","TooltipWrapper","applyLabelAndComponentWrapperStyle","Label","applyValidateMessageWrapperStyle","InvalidMessage"],"mappings":"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"}