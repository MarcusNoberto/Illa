import{k as e,c8 as Z,c9 as ee,n as h,T as D,ca as te,o as u,cb as se,F as $,q as oe,bB as ne,bC as ae,bz as re,bA as ie,cc as ce,aQ as A,aV as le,aa as pe}from"./@illa-design-402f214a.js";import{f6 as W,cV as V,b as a,dO as de,f7 as z,e as M,e_ as R,_ as P,cQ as B,a as E,bf as G,n as _,B as H,q as x,f8 as ue,f9 as ge,u as F,g as j,fa as me,d7 as he,l as fe,bC as be,fb as Le,z as Ce,fc as ye,as as k,o as Ae,p as Ie,s as Ee,fd as N,fe as Pe,ff as we,aq as I,fg as Te,fh as Se,bn as Be,t as De,E as S,a3 as Me,a4 as U,W as Re,x as L}from"./index-2f1869ab.js";import{r,u as v,m as K,o as _e}from"./react-9b7e00e3.js";import{s as xe,b as ve,h as Oe,e as ke,j as Ne,c as Ue,m as $e,f as We,k as Ve,o as ze,p as Ge,w as He}from"./style-bd23c0f2.js";import{M as Fe,D as je,P as Ke,A as Xe,a as qe,C as Qe,S as Ye,b as Je}from"./index-e89bb2f6.js";import{s as Ze,a as et,b as tt,C as st}from"./layoutInfoListener-bba65cc8.js";import{a as ot}from"./index-461ab516.js";import{u as nt}from"./hook-34b2061f.js";import{a as f}from"./@emotion-4f16718e.js";import{p as at}from"./renderComponentCanvasContainer-44ad78fe.js";import"./codeMirror-vendor-eff8ab8d.js";import"./lodash-lib-6e94956b.js";import"./react-icons-vendor-2430ea65.js";import"./index-9dcf4ab8.js";import"./index-65ed348a.js";import"./index-e7294a86.js";import"./clsx.m-925abe8b.js";import"./clsx.m-266f4de0.js";import"./index-323e87cb.js";import"./style-91620c64.js";import"./index-b8442d1a.js";import"./drive-6b05f117.js";import"./objectWithoutPropertiesLoose-4f48578a.js";import"./popper-cd761d27.js";import"./clsx-85d7d0af.js";import"./objectWithoutPropertiesLoose-24430c43.js";import"./style-7ce959a8.js";import"./index-f466602f.js";import"./index-cf2bb556.js";const rt=async(s,n)=>await W({url:`/room/websocketConnection/app/${s}`,method:"GET",signal:n},{teamID:V()}),it=async(s,n)=>await W({url:`/room/binaryWebsocketConnection/app/${s}`,method:"GET",signal:n},{teamID:V()}),ct=()=>{const s=a(de),n=a(z),t=r.useMemo(()=>{if(s){let l=0;return Object.keys(s).forEach(p=>{Array.isArray(s[p])&&(l+=s[p].length)}),l}},[s]),c=M(),i=()=>{B(E.CLICK,{element:"debug",parameter2:t??0}),c(G.updateDebuggerVisible(!n))};return e(D,{position:"right",content:R("flow.editor.app.tooltips.debug"),children:e(P,{onClick:i,children:e(Z,{count:t,children:e(ee,{color:h("grayBlue","02")})})})})},lt=r.memo(ct),pt=()=>{var o,d;const{teamIdentifier:s,appId:n}=v(),t=a(_),c=K(),i=nt(),l=H(t==null?void 0:t.myRole,x(t),(o=t==null?void 0:t.totalTeamLicense)==null?void 0:o.teamLicensePurchased,(d=t==null?void 0:t.totalTeamLicense)==null?void 0:d.teamLicenseAllPaid),p=()=>{l?c(`/${s}/appHistory/${n}`):i({modalType:"upgrade",from:"app_edit_more_history"})};return e(D,{position:"right",content:R("flow.editor.app.tooltips.edit_history"),children:e(P,{onClick:p,children:e(te,{color:h("grayBlue","02")})})})},dt=r.memo(pt),ut=()=>{const s=a(ue),[n,t]=r.useState(s),[c,i]=r.useState(!1);r.useEffect(()=>{t(s)},[s]);const l=()=>{t(!0)},p=o=>{o?t(!0):(t(!1),i(!0),setTimeout(()=>{i(!1)},1500))};return s&&u($,{children:[e(D,{content:R("flow.editor.flow.tooltips.missing_resources"),position:"right",popupVisible:c,onVisibleChange:i,children:e(P,{onClick:l,children:e(se,{color:h("orange","03")})})}),e(Fe,{shown:n,changeShown:p})]})},gt=r.memo(ut),X=f`
  display: flex;
  flex-direction: row;
  align-items: center;
`;f`
  ${X};
  justify-content: space-between;
  gap: 8px;
`;f`
  color: ${h("grayBlue","04")};
  font-size: 14px;
  font-weight: 400;
  line-height: 22px;
  text-transform: capitalize;
`;f`
  ${X};
  gap: 8px;
`;const mt=128,q=" Copy",ht=mt-q.length,ft=(s,n)=>{const t=`${(n||"").slice(0,ht)}${q}`;return ge(s,t)},bt=()=>{var b,C;const{teamIdentifier:s,appId:n}=v(),[t,c]=r.useState(!1),{t:i}=F(),l=K();M();const p=a(j),o=a(_);a(me);const d=oe();H(o==null?void 0:o.myRole,x(o),(b=o==null?void 0:o.totalTeamLicense)==null?void 0:b.teamLicensePurchased,(C=o==null?void 0:o.totalTeamLicense)==null?void 0:C.teamLicenseAllPaid);const w=m=>{m&&B(E.SHOW,{element:"app_duplicate",parameter5:n})},T=async()=>{if(B(E.CLICK,{element:"app_duplicate",parameter5:n}),!t){c(!0);try{const m=await ft(p.appId,p.appName);l(`/${s}/app/${m.data.appId}`)}catch(m){fe(m)?d.error({content:i("dashboard.app.duplicate_fail")}):d.error({content:i("network_error")})}finally{c(!1)}}};return e(ie,{position:"bottom-end",trigger:"click",triggerProps:{closeDelay:0,openDelay:0},onVisibleChange:w,dropList:u(ae,{children:[e(ne,{value:"duplicate",title:i("duplicate"),onClick:T},"duplicate"),he]}),children:e(P,{children:e(re,{color:h("grayBlue","02")})})})},Lt=r.memo(bt),Ct=f`
  display: flex;
  flex-direction: column;
  height: 100%;
  border-right: 1px solid ${h("grayBlue","08")};
  background-color: white;
  padding: 12px;
  gap: 24px;
`,yt=()=>{const s=a(be);return u("div",{css:Ct,children:[e(gt,{}),e(lt,{}),!s&&e(dt,{}),!s&&e(Lt,{})]})},At=r.memo(yt),It=f`
  display: flex;
  height: 100%;
  flex: none;
`,Et=()=>{const s=a(Le);return u("div",{css:It,children:[e(At,{}),s&&e(je,{})]})},Pt=r.memo(Et),wt=()=>{const s=M(),{t:n}=F(),{appId:t}=v(),c=ce(),i=a(Ce),l=a(_),p=a(ye),o=l==null?void 0:l.myRole,d=r.useCallback(()=>{k.leaveRoom("app",t??"")},[t]);if(o&&!Ae(o,Ee.APP,x(l),Ie.EDIT_APP))throw new Error("You don't have permission to edit this app");r.useEffect(()=>{const g=new AbortController;return i!=null&&i.userID!=""&&t&&(Promise.all([rt(t,g.signal),it(t,g.signal)]).then(y=>{k.enterAppRoom(N(y[0].data.wsURL),N(y[1].data.wsURL),t)}).catch(()=>{}),window.addEventListener("beforeunload",d)),()=>{g.abort(),d(),s(Pe.setInRoomUsers({inRoomUsers:[]})),s(G.updateWSStatusReducer({context:we.APP,wsStatus:I.CLOSED})),window.removeEventListener("beforeunload",d)}},[i,t,d,s]),r.useEffect(()=>{const g=[Ze(L),et(L),tt(L),xe(L),ve(L)];return()=>g.forEach(y=>y())},[]);const w=a(Te),T=a(Se),b=a(z),C=a(Be),{loadingState:m}=Oe("edit"),Q=r.useCallback(g=>{g.stopPropagation(),c.start({scale:1.05,transition:{duration:.2}}).then(()=>{c.start({scale:1,transition:{duration:.2}})})},[c]);r.useEffect(()=>(De(E.VISIT,S.EDITOR),Me(),()=>{U(S.EDITOR)}),[]),_e(()=>{U(S.EDITOR)});const[,Y]=at(),J=a(j),O=m||p===I.INIT||p===I.CONNECTING;return u($,{children:[e(Re,{children:e("title",{children:J.appName})}),u("div",{css:ke,ref:Y,children:[O&&e(Je,{}),!O&&e(Ye,{children:u(ot,{children:[e(A,{renderInBody:!0,zIndex:10,children:e(Ke,{css:Ne})}),u("div",{css:Ue,children:[e(Pt,{}),u("div",{css:$e,children:[e(A,{renderInBody:!0,zIndex:10,children:e(st,{css:We})}),e(A,{renderInBody:!0,zIndex:10,children:T&&!b?e(Xe,{}):null}),b&&e(qe,{css:Ve})]}),w&&e(A,{renderInBody:!0,zIndex:10,children:e(Qe,{})})]}),!C&&e("div",{css:ze,onMouseDown:Q,children:u(le.div,{css:Ge,animate:c,children:[e(pe,{css:He}),p===I.LOCKING?n("editor.history.message.version_change"):n("not_online_tips")]})})]})})]})]})};wt.displayName="Editor";export{wt as Editor,wt as default};
//# sourceMappingURL=index-580cc333.js.map
