{"version":3,"file":"numberInput-adfa75b1.js","sources":["../../src/widgetLibrary/NumberInputWidget/utils.ts","../../src/widgetLibrary/NumberInputWidget/numberInput.tsx"],"sourcesContent":["import {\n  getValidateVFromString,\n  handleValidateCheck,\n} from \"../PublicSector/InvalidMessage/utils\"\nimport { NumberInputWidgetProps } from \"./interface\"\n\nexport const getValidateMessageFunc = (\n  value: unknown,\n  options: {\n    hideValidationMessage?: NumberInputWidgetProps[\"hideValidationMessage\"]\n    pattern?: NumberInputWidgetProps[\"pattern\"]\n    regex?: NumberInputWidgetProps[\"regex\"]\n    required?: NumberInputWidgetProps[\"required\"]\n    customRule?: NumberInputWidgetProps[\"customRule\"]\n  } = {},\n) => {\n  const {\n    hideValidationMessage,\n    pattern,\n    regex,\n\n    required,\n    customRule,\n  } = options\n  if (!hideValidationMessage) {\n    const message = handleValidateCheck({\n      value: getValidateVFromString(value),\n      pattern,\n      regex,\n      required,\n      customRule,\n    })\n    const showMessage = message && message.length > 0\n    return showMessage ? message : \"\"\n  }\n  return \"\"\n}\n","import { debounce } from \"lodash-es\"\nimport { FC, forwardRef, useCallback, useEffect, useRef, useState } from \"react\"\nimport { InputNumber, LoadingIcon } from \"@illa-design/react\"\nimport {\n  NumberInputWidgetProps,\n  WrappedNumberInputProps,\n} from \"@/widgetLibrary/NumberInputWidget/interface\"\nimport { AutoHeightContainer } from \"@/widgetLibrary/PublicSector/AutoHeightContainer\"\nimport { InvalidMessage } from \"@/widgetLibrary/PublicSector/InvalidMessage\"\nimport { Label } from \"@/widgetLibrary/PublicSector/Label\"\nimport { TooltipWrapper } from \"@/widgetLibrary/PublicSector/TooltipWrapper\"\nimport {\n  applyLabelAndComponentWrapperStyle,\n  applyValidateMessageWrapperStyle,\n} from \"@/widgetLibrary/PublicSector/TransformWidgetWrapper/style\"\nimport { getValidateMessageFunc } from \"./utils\"\n\nconst parserThousand = (value: number | string) =>\n  `${value}`.replace(/\\d+/, function (s) {\n    return s.replace(/(\\d)(?=(\\d{3})+$)/g, \"$1,\")\n  })\n\nexport const WrappedInputNumber = forwardRef<\n  HTMLInputElement,\n  WrappedNumberInputProps\n>((props, ref) => {\n  const {\n    openThousandSeparator,\n    max,\n    min,\n    placeholder,\n    value,\n    precision,\n    disabled,\n    readOnly,\n    prefix,\n    suffix,\n    loading,\n    colorScheme,\n    handleOnChange,\n    handleOnBlur,\n    handleOnFocus,\n  } = props\n\n  return (\n    <InputNumber\n      inputRef={ref}\n      max={max}\n      min={min}\n      formatter={openThousandSeparator ? parserThousand : undefined}\n      placeholder={placeholder}\n      value={value}\n      precision={precision}\n      disabled={disabled}\n      readOnly={readOnly}\n      prefix={prefix}\n      suffix={loading ? <LoadingIcon spin /> : suffix}\n      mode=\"button\"\n      onChange={handleOnChange}\n      onBlur={handleOnBlur}\n      onFocus={handleOnFocus}\n      colorScheme={colorScheme}\n    />\n  )\n})\nWrappedInputNumber.displayName = \"WrappedInputNumber\"\nexport const NumberInputWidget: FC<NumberInputWidgetProps> = (props) => {\n  const {\n    displayName,\n    value,\n    handleUpdateDsl,\n    updateComponentRuntimeProps,\n    deleteComponentRuntimeProps,\n    labelPosition,\n    labelFull,\n    label,\n    labelAlign,\n    labelWidth = 33,\n    labelCaption,\n    labelWidthUnit,\n    required,\n    labelHidden,\n    tooltipText,\n    pattern,\n    regex,\n    customRule,\n    hideValidationMessage,\n    updateComponentHeight,\n    validateMessage,\n    defaultValue,\n    triggerEventHandler,\n    handleUpdateMultiExecutionResult,\n  } = props\n  const numberInputRef = useRef<HTMLInputElement>(null)\n  const [numberInputValue, setNumberInputValue] = useState(\n    value || defaultValue,\n  )\n\n  useEffect(() => {\n    if (\n      typeof defaultValue === \"undefined\" ||\n      typeof defaultValue === \"number\"\n    ) {\n      setNumberInputValue(defaultValue)\n      handleUpdateMultiExecutionResult([\n        {\n          displayName,\n          value: {\n            value: (defaultValue as unknown) === \"\" ? undefined : defaultValue,\n          },\n        },\n      ])\n    }\n  }, [defaultValue, displayName, handleUpdateMultiExecutionResult])\n\n  const debounceOnChange = useRef(\n    debounce(\n      (\n        value: number | undefined,\n        triggerEventHandler: NumberInputWidgetProps[\"triggerEventHandler\"],\n        options?: {\n          hideValidationMessage?: NumberInputWidgetProps[\"hideValidationMessage\"]\n          pattern?: NumberInputWidgetProps[\"pattern\"]\n          regex?: NumberInputWidgetProps[\"regex\"]\n          required?: NumberInputWidgetProps[\"required\"]\n          customRule?: NumberInputWidgetProps[\"customRule\"]\n        },\n      ) => {\n        new Promise((resolve) => {\n          const message = getValidateMessageFunc(value, options)\n          handleUpdateMultiExecutionResult([\n            {\n              displayName,\n              value: {\n                value: (value as unknown) === \"\" ? undefined : value,\n                validateMessage: message,\n              },\n            },\n          ])\n          resolve(true)\n        }).then(() => {\n          triggerEventHandler(\"change\")\n        })\n      },\n\n      180,\n    ),\n  )\n\n  const handleOnChange = useCallback(\n    (value?: number | undefined) => {\n      setNumberInputValue(value)\n      debounceOnChange.current(value, triggerEventHandler, {\n        hideValidationMessage,\n        pattern,\n        regex,\n        required,\n        customRule,\n      })\n    },\n    [\n      customRule,\n      hideValidationMessage,\n      pattern,\n      regex,\n      required,\n      triggerEventHandler,\n    ],\n  )\n\n  const handleValidate = useCallback(\n    (value?: unknown) => {\n      const message = getValidateMessageFunc(value, {\n        hideValidationMessage: hideValidationMessage,\n        pattern: pattern,\n        regex: regex,\n        required: required,\n        customRule: customRule,\n      })\n      handleUpdateDsl({\n        validateMessage: message,\n      })\n      return message\n    },\n    [\n      customRule,\n      handleUpdateDsl,\n      hideValidationMessage,\n      pattern,\n      regex,\n      required,\n    ],\n  )\n\n  useEffect(() => {\n    updateComponentRuntimeProps({\n      focus: () => {\n        numberInputRef.current?.focus()\n      },\n      setValue: (value: number) => {\n        if (typeof value === \"number\" || typeof value === \"undefined\") {\n          handleOnChange(value)\n        }\n      },\n      clearValue: () => {\n        handleOnChange(0)\n      },\n      validate: () => {\n        return handleValidate(value)\n      },\n      clearValidation: () => {\n        handleUpdateDsl({\n          validateMessage: \"\",\n        })\n      },\n    })\n\n    return () => {\n      deleteComponentRuntimeProps()\n    }\n  }, [\n    deleteComponentRuntimeProps,\n    handleOnChange,\n    handleUpdateDsl,\n    handleValidate,\n    updateComponentRuntimeProps,\n    value,\n  ])\n\n  return (\n    <AutoHeightContainer updateComponentHeight={updateComponentHeight}>\n      <TooltipWrapper tooltipText={tooltipText} tooltipDisabled={!tooltipText}>\n        <div css={applyLabelAndComponentWrapperStyle(labelPosition)}>\n          <Label\n            labelFull={labelFull}\n            label={label}\n            labelAlign={labelAlign}\n            labelWidth={labelWidth}\n            labelCaption={labelCaption}\n            labelWidthUnit={labelWidthUnit}\n            labelPosition={labelPosition}\n            required={required}\n            labelHidden={labelHidden}\n            hasTooltip={!!tooltipText}\n          />\n          <WrappedInputNumber\n            {...props}\n            value={numberInputValue}\n            ref={numberInputRef}\n            handleOnChange={handleOnChange}\n            handleOnBlur={() => {\n              triggerEventHandler(\"blur\")\n            }}\n            handleOnFocus={() => {\n              triggerEventHandler(\"focus\")\n            }}\n          />\n        </div>\n      </TooltipWrapper>\n      {!hideValidationMessage && (\n        <div\n          css={applyValidateMessageWrapperStyle(\n            labelWidth,\n            labelPosition,\n            labelHidden || !label,\n          )}\n        >\n          <InvalidMessage validateMessage={validateMessage} />\n        </div>\n      )}\n    </AutoHeightContainer>\n  )\n}\nNumberInputWidget.displayName = \"NumberInputWidget\"\nexport default NumberInputWidget\n"],"names":["getValidateMessageFunc","value","options","hideValidationMessage","pattern","regex","required","customRule","message","handleValidateCheck","getValidateVFromString","parserThousand","s","WrappedInputNumber","forwardRef","props","ref","openThousandSeparator","max","min","placeholder","precision","disabled","readOnly","prefix","suffix","loading","colorScheme","handleOnChange","handleOnBlur","handleOnFocus","jsx","InputNumber","LoadingIcon","NumberInputWidget","displayName","handleUpdateDsl","updateComponentRuntimeProps","deleteComponentRuntimeProps","labelPosition","labelFull","label","labelAlign","labelWidth","labelCaption","labelWidthUnit","labelHidden","tooltipText","updateComponentHeight","validateMessage","defaultValue","triggerEventHandler","handleUpdateMultiExecutionResult","numberInputRef","useRef","numberInputValue","setNumberInputValue","useState","useEffect","debounceOnChange","debounce","resolve","useCallback","handleValidate","_a","jsxs","AutoHeightContainer","TooltipWrapper","applyLabelAndComponentWrapperStyle","Label","applyValidateMessageWrapperStyle","InvalidMessage"],"mappings":"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"}