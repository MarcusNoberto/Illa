import{ab as ie,k as se,bY as ue,N as G,bZ as ce}from"./@illa-design-1f43bb6c.js";import{b as de,cF as pe,dg as fe,aB as ge,eo as me,ep as Ce,eq as he,er as be,es as Se}from"./index-4dce6ee8.js";import{r as n}from"./react-9b7e00e3.js";import{i as ye,w as Re,t as we}from"./lodash-lib-6e94956b.js";import"./@emotion-08a6282b.js";import"./codeMirror-vendor-320207e2.js";import"./react-icons-vendor-2430ea65.js";const ae=n.forwardRef((H,W)=>{const{displayName:b,data:d,loading:l,emptyState:J,columns:L,columnSizing:_,filter:$,refresh:F,download:T,downloadRawData:I,overFlow:N,pageSize:f,pageIndex:S=0,rowSelection:x,defaultSort:Y,columnVisibility:Z,multiRowSelection:z,enableSingleCellSelection:A,clickOutsideToResetSelection:R,enableServerSidePagination:y,totalRowCount:i,paginationType:p,nextBeforeCursor:U,nextAfterCursor:g,handleOnRefresh:Q,handleOnRowClick:X,handleOnSortingChange:D,handleOnPaginationChange:v,handleOnFiltersChange:w,handleOnRowSelectChange:O,handleOnCellSelect:ee,handleUpdateMultiExecutionResult:h,handleUpdateOriginalDSLMultiAttr:k}=H,K=de(pe),[q,te]=n.useState([]),m=n.useMemo(()=>Array.isArray(d)?d:[],[d]),j=n.useMemo(()=>(p==="cursorBased"||p==="graphqlRelayCursorBased")&&y,[p,y]),t=n.useMemo(()=>{const e=f||((d==null?void 0:d.length)??10),a=S*e;return q.slice(a,a+e)},[q,S,f,d==null?void 0:d.length]),o=n.useCallback(e=>{p==="cursorBased"&&te((a=[])=>ye(a,e)?a:[...a,...e])},[p]);n.useEffect(()=>{o(m)},[m,o]);const s=n.useCallback(e=>{K==="edit"?k(e,!0):h([{displayName:b,value:e}])},[K,h,k,b]),c=n.useCallback(e=>{var E;let a=[],C=[];ie(e)&&((E=Object.keys(e))==null||E.map(V=>{const B=Number(V);m[B]&&(a.push(m[B]),C.push(B))})),s({selectedRowIndex:C,selectedRow:a,rowSelection:e}),O==null||O()},[m,s,O]),u=n.useCallback((e,a)=>{const C=a.getSortedRowModel().rows,M=C==null?void 0:C.map(re=>{const ne={};return re.getVisibleCells().forEach(oe=>{ne[oe.column.id]=oe.getValue()}),ne}),E=C==null?void 0:C.map(re=>re.index),{pageIndex:V,pageSize:B}=e,le=V>0?V*B:0,P={pageIndex:V,paginationOffset:le,displayedData:M,displayedDataIndices:E};y&&(p==="cursorBased"?S>V||(P.afterCursor=g):p==="graphqlRelayCursorBased"&&(S>V?(P.beforeCursor=U,P.afterCursor=null):(P.beforeCursor=null,P.afterCursor=g))),h([{displayName:b,value:P}]),v==null||v()},[b,h,v,y,U,g,p,S]),r=n.useCallback((e,a)=>{h([{displayName:b,value:{filters:e,filterOperator:a}}]),w==null||w()},[b,h,w]);return se(ue,{bordered:!0,striped:!0,borderedCell:!0,pinedHeader:!0,w:"100%",h:"100%",tableRef:W,enableColumnResizing:K==="edit",enableSingleCellSelection:A,serverSidePagination:y,total:i,colorScheme:"techPurple",rowSelection:x,data:p==="cursorBased"?t:m,columns:L,columnSizing:_,filter:$,loading:l,refresh:F,download:T,downloadRawData:I,overFlow:N,pagination:{pageSize:y?f||(d==null?void 0:d.length):f,disableSimplePageJump:j},emptyProps:{description:J},defaultSort:Y,columnVisibility:Z,multiRowSelection:z,clickOutsideToResetRowSelect:R,onRefresh:Q,onRowClick:X,onPaginationChange:u,onGlobalFiltersChange:r,onColumnFiltersChange:w,onColumnSizingChange:Re(e=>{s({columnSizing:e})},100),onRowSelectionChange:c,onSortingChange:e=>{let a;e!=null&&e.length&&(a={sortKey:e[0].id,sortOrder:e[0].desc?"descend":"ascend"}),h([{displayName:b,value:{sort:a}}]),D==null||D()},onCellSelectionChange:e=>{var C,M,E;const a=e?{index:e.row.index,columnName:e.column.id,value:e.getValue()}:{};(C=e==null?void 0:e.column.columnDef.meta)!=null&&C.haveMappedValue&&(a.mappedValue=(E=(M=e.column.columnDef.meta)==null?void 0:M.getRenderedValueAsString)==null?void 0:E.call(M,e.getContext())),h([{displayName:b,value:{selectedCell:a}}]),ee()}})}),Fe=H=>{const{emptyState:W,selectedRow:b,loading:d,columns:l,filter:J,download:L,overFlow:_,pageSize:$,dataSource:F,dataSourceJS:T,dataSourceMode:I,displayName:N,defaultSortKey:f,defaultSortOrder:S,multiRowSelection:x,columnSizing:Y,handleUpdateDsl:Z,updateComponentRuntimeProps:z,deleteComponentRuntimeProps:A,handleUpdateOriginalDSLMultiAttr:R,handleUpdateMultiExecutionResult:y,triggerEventHandler:i,triggerMappedEventHandler:p,...U}=H,g=n.useRef(null),Q=n.useCallback(()=>{i("refresh")},[i]),X=n.useCallback(()=>{i("onCellSelect")},[i]),D=n.useCallback(()=>{i("rowClick")},[i]),v=n.useCallback(()=>{i("rowSelectChange")},[i]),w=n.useCallback(()=>{i("sortingChange")},[i]),O=n.useCallback(()=>{i("paginationChange")},[i]),ee=n.useCallback(()=>{i("filtersChange")},[i]),h=n.useCallback((t,o)=>{G(o)?p("clickMenuItem",t,o,s=>fe(we(s).slice(-2)),s=>s.includes("currentRow")):i("clickMenuItem",t)},[i,p]),k=n.useCallback(t=>l.map(s=>s.accessorKey).includes(t),[l]),K=n.useMemo(()=>!f||f==="default"?[]:k(f)?[{id:f,desc:S==="descend"}]:[],[S,f,k]),q=n.useMemo(()=>{const t={};return l==null||l.forEach(o=>{const{visible:s,accessorKey:c}=o;s||(t[c]=!1)}),t},[l]),te=n.useMemo(()=>{const t=[];return l==null||l.forEach((o,s)=>{const c=`rowEvents.${s}`,u=ge(o);u.meta={haveMappedValue:"mappedValue"in u,getBackgroundColor:r=>me(r,u.backgroundColor,u.fromCurrentRow,"backgroundColor",""),getRenderedValueAsString:r=>Ce(r,u.mappedValue,u.fromCurrentRow),style:he(o.alignment),custom:o.custom},u.cell=be(u,c,h,s),t.push(u)}),t},[l,h]),m=n.useMemo(()=>I==="dynamic"?T||[]:F||[],[F,T,I]),j=n.useMemo(()=>{const t={};return l==null||l.forEach((o,s)=>{const{events:c}=o;c&&(t[s]=Se(c,m.length))}),t},[l,m==null?void 0:m.length]);return n.useEffect(()=>{R({rowEvents:j},!0)},[R,j]),n.useEffect(()=>{const t=l.reduce((r,e,a)=>(e.custom&&(r[a]=e.header),r),{}),o=l.reduce((r,e,a)=>(e.custom?r[a]=e.header:r[a]=e.accessorKey,r),{}),s=l.reduce((r,e)=>(e.header!==e.accessorKey&&!e.custom&&(r[e.accessorKey]=e.header),r),{}),c=l.reduce((r,e)=>(e.custom?r[e.header]=!!e.visible:r[e.accessorKey]=!!e.visible,r),{}),u=l.reduce((r,e)=>(e.custom?r[e.header]=e:r[e.accessorKey]=e,r),{});R({customColumnIndices:t,columnNameIndices:o,renamedColumnNames:s,columnVisibility:c,columnMapper:u},!0)},[R,l]),n.useEffect(()=>(z({clearSelection:()=>{var t;(t=g.current)==null||t.clearSelection()},clearFilters:()=>{var t;(t=g.current)==null||t.setGlobalFilters([],"and")},setFilters:(t,o)=>{var c;const s=o==="and"||o==="or"?o:"and";if(Array.isArray(t)){const u=t.filter(r=>ce(r));(c=g.current)==null||c.setGlobalFilters(u,s)}},setSort:(t,o)=>{var s;k(t)&&((s=g.current)==null||s.table.setSorting([{id:t,desc:o!=="ascend"}]))},selectPage:t=>{var o;if(!G(t)){console.error("TypeError: value is not a number");return}(o=g.current)==null||o.selectPage(t)},selectRow:t=>{var o,s;if(G(t))(o=g.current)==null||o.selectRow({[t]:!0});else if(Array.isArray(t)){const c=t.slice(0,x?void 0:1).reduce((u,r)=>(G(r)&&(u[r]=!0),console.error(`TypeError: ${r} is not a number`),u),{});(s=g.current)==null||s.selectRow(c)}else console.error("TypeError: value is not a number or array")}}),()=>{A()}),[z,A,N,x,k]),se(ae,{...U,ref:g,selectedRow:b,displayName:N,data:m,emptyState:W,loading:d,filter:J,columns:te,columnSizing:Y,download:L,overFlow:_,pageSize:$,columnVisibility:q,defaultSort:K,multiRowSelection:x,triggerMappedEventHandler:p,updateComponentRuntimeProps:z,deleteComponentRuntimeProps:A,handleUpdateOriginalDSLMultiAttr:R,handleUpdateMultiExecutionResult:y,handleUpdateDsl:Z,handleOnCellSelect:X,handleOnSortingChange:w,handleOnPaginationChange:O,handleOnFiltersChange:ee,handleOnRowSelectChange:v,handleOnRowClick:D,handleOnRefresh:Q})};ae.displayName="WrappedTable";export{Fe as TableWidget,ae as WrappedTable,Fe as default};
//# sourceMappingURL=table-d7434582.js.map
