{"version":3,"file":"audio-07e5bf0c.js","sources":["../../src/widgetLibrary/AudioWidget/style.ts","../../src/widgetLibrary/AudioWidget/audio.tsx"],"sourcesContent":["import { SerializedStyles, css } from \"@emotion/react\"\nimport { getColor } from \"@illa-design/react\"\n\nexport const fullStyle = css`\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n  display: flex;\n  align-items: center;\n`\n\nexport const loadingStyle = css`\n  width: 100%;\n  height: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  //background-color: ${getColor(\"gray\", \"01\")};\n  color: ${getColor(\"black\", \"01\")};\n`\n\nexport const audioWrapperStyle = css`\n  & > audio {\n    &::-webkit-media-controls {\n      justify-content: center;\n    }\n  }\n`\n\nexport const applyHiddenStyle = (hidden: boolean): SerializedStyles => {\n  return css`\n    visibility: ${hidden ? \"hidden\" : \"visible\"};\n  `\n}\n\nexport const audioStyle = css`\n  display: flex;\n  gap: 16px;\n  padding: 8px;\n  max-height: 48px;\n  width: 100%;\n  background: ${getColor(\"white\", \"01\")};\n  border: 1px solid ${getColor(\"grayBlue\", \"08\")};\n  border-radius: 24px;\n`\n","import { isBoolean } from \"lodash-es\"\nimport {\n  FC,\n  forwardRef,\n  useCallback,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\"\nimport ReactPlayer from \"react-player\"\nimport { Loading, isNumber, isString } from \"@illa-design/react\"\nimport { MediaSourceLoadContext } from \"@/utils/mediaSourceLoad\"\nimport {\n  audioWrapperStyle,\n  fullStyle,\n  loadingStyle,\n} from \"@/widgetLibrary/AudioWidget/style\"\nimport { TooltipWrapper } from \"@/widgetLibrary/PublicSector/TooltipWrapper\"\nimport { AudioWidgetProps, WrappedAudioProps } from \"./interface\"\n\nexport const WrappedAudio = forwardRef<ReactPlayer, WrappedAudioProps>(\n  (props, ref) => {\n    const {\n      url,\n      playing,\n      autoPlay,\n      controls = true,\n      loop,\n      volume,\n      muted,\n      playbackRate,\n      onPlay,\n      onReady,\n      onPause,\n      onEnded,\n      onPlaybackRateChange,\n    } = props\n    const [loading, setLoading] = useState(true)\n    const [_error, setError] = useState(false)\n    const { sourceLoadErrorHandler } = useContext(MediaSourceLoadContext)\n\n    return (\n      <>\n        {loading ? (\n          <div css={loadingStyle}>\n            <Loading colorScheme=\"black\" />\n          </div>\n        ) : null}\n        <ReactPlayer\n          css={audioWrapperStyle}\n          style={loading ? { display: \"none\" } : undefined}\n          config={{\n            file: {\n              forceAudio: true,\n            },\n          }}\n          ref={ref}\n          width=\"100%\"\n          height=\"100%\"\n          // show unavailable link state for audio empty state\n          url={url || \" \"}\n          volume={volume}\n          muted={muted}\n          controls={controls}\n          playbackRate={playbackRate}\n          loop={loop}\n          playing={autoPlay || playing}\n          draggable={false}\n          onReady={() => {\n            setLoading(false)\n            setError(false)\n            onReady()\n          }}\n          onPlay={onPlay}\n          onPause={onPause}\n          onEnded={onEnded}\n          onError={() => {\n            sourceLoadErrorHandler?.(url, \"AUDIO_WIDGET\")\n            setLoading(false)\n            setError(true)\n          }}\n          onPlaybackRateChange={onPlaybackRateChange}\n        />\n      </>\n    )\n  },\n)\n\nWrappedAudio.displayName = \"WrappedAudio\"\n\nexport const AudioWidget: FC<AudioWidgetProps> = (props) => {\n  const {\n    handleUpdateDsl,\n    handleUpdateMultiExecutionResult,\n    displayName,\n    tooltipText,\n    triggerEventHandler,\n    deleteComponentRuntimeProps,\n    updateComponentRuntimeProps,\n  } = props\n\n  const audioRef = useRef<ReactPlayer>(null)\n\n  useEffect(() => {\n    updateComponentRuntimeProps({\n      play: () => {\n        handleUpdateMultiExecutionResult([\n          {\n            displayName,\n            value: { playing: true },\n          },\n        ])\n      },\n      pause: () => {\n        handleUpdateMultiExecutionResult([\n          {\n            displayName,\n            value: { playing: false },\n          },\n        ])\n      },\n      setAudioUrl: (url: string) => {\n        if (!isString(url)) {\n          console.error(\"TypeError: url is not a string\")\n          return\n        }\n        handleUpdateMultiExecutionResult([\n          {\n            displayName,\n            value: { url },\n          },\n        ])\n      },\n      seekTo: (time: number, type: \"seconds\" | \"fraction\" = \"seconds\") => {\n        if (!isNumber(time)) {\n          console.error(\"TypeError: value is not a number\")\n          return\n        }\n        audioRef.current?.seekTo(time, type)\n      },\n      mute: (value: boolean) => {\n        if (!isBoolean(value)) {\n          console.error(\"TypeError: value is not a boolean\")\n          return\n        }\n        const audio = audioRef.current?.getInternalPlayer() as HTMLAudioElement\n        if (audio) {\n          // As the player doesn't update internally, it's necessary to modify the DOM directly.\n          audio.muted = value\n        }\n        handleUpdateMultiExecutionResult([\n          {\n            displayName,\n            value: { muted: value },\n          },\n        ])\n      },\n      setLoop: (value: boolean) => {\n        if (!isBoolean(value)) {\n          console.error(\"TypeError: value is not a boolean\")\n          return\n        }\n        const audio = audioRef.current?.getInternalPlayer() as HTMLAudioElement\n        if (audio) {\n          // As the player doesn't update internally, it's necessary to modify the DOM directly.\n          audio.loop = value\n        }\n        handleUpdateMultiExecutionResult([\n          {\n            displayName,\n            value: { loop: value },\n          },\n        ])\n      },\n      setSpeed: (value: number) => {\n        if (!isNumber(value)) {\n          console.error(\"TypeError: value is not a number\")\n          return\n        }\n        // playbackRate range [0.0625, 16]\n        const clampedValue = Math.max(0.0625, Math.min(16, value))\n        handleUpdateMultiExecutionResult([\n          {\n            displayName,\n            value: { playbackRate: clampedValue },\n          },\n        ])\n      },\n      setVolume: (value: number) => {\n        if (!isNumber(value)) {\n          console.error(\"TypeError: value is not a number\")\n          return\n        }\n        // volume range [0, 1]\n        const clampedValue = Math.max(0, Math.min(1, value))\n        const audio = audioRef.current?.getInternalPlayer() as HTMLAudioElement\n        if (audio) {\n          // As the player doesn't update internally, it's necessary to modify the DOM directly.\n          audio.volume = clampedValue\n        }\n        handleUpdateMultiExecutionResult([\n          {\n            displayName,\n            value: { volume: clampedValue },\n          },\n        ])\n      },\n    })\n    return () => {\n      deleteComponentRuntimeProps()\n    }\n  }, [\n    displayName,\n    handleUpdateMultiExecutionResult,\n    handleUpdateDsl,\n    updateComponentRuntimeProps,\n    deleteComponentRuntimeProps,\n  ])\n\n  const onPlay = useCallback(() => {\n    handleUpdateMultiExecutionResult([\n      {\n        displayName,\n        value: { playing: true },\n      },\n    ])\n    triggerEventHandler(\"play\")\n  }, [displayName, triggerEventHandler, handleUpdateMultiExecutionResult])\n\n  const onPause = useCallback(() => {\n    handleUpdateMultiExecutionResult([\n      {\n        displayName,\n        value: { playing: false },\n      },\n    ])\n    triggerEventHandler(\"pause\")\n  }, [displayName, triggerEventHandler, handleUpdateMultiExecutionResult])\n\n  const onReady = useCallback(() => {\n    triggerEventHandler(\"loaded\")\n  }, [triggerEventHandler])\n\n  const onEnded = useCallback(() => {\n    triggerEventHandler(\"ended\")\n  }, [triggerEventHandler])\n\n  const onPlaybackRateChange = useCallback(\n    (playbackRate: number) => {\n      if (isNumber(playbackRate)) {\n        handleUpdateMultiExecutionResult([\n          {\n            displayName,\n            value: { playbackRate },\n          },\n        ])\n      }\n    },\n    [displayName, handleUpdateMultiExecutionResult],\n  )\n\n  return (\n    <TooltipWrapper tooltipText={tooltipText} tooltipDisabled={!tooltipText}>\n      <div css={fullStyle}>\n        <WrappedAudio\n          {...props}\n          ref={audioRef}\n          onReady={onReady}\n          onPlay={onPlay}\n          onPause={onPause}\n          onEnded={onEnded}\n          onPlaybackRateChange={onPlaybackRateChange}\n        />\n      </div>\n    </TooltipWrapper>\n  )\n}\n\nAudioWidget.displayName = \"AudioWidget\"\n\nexport default AudioWidget\n"],"names":["fullStyle","css","loadingStyle","getColor","audioWrapperStyle","WrappedAudio","forwardRef","props","ref","url","playing","autoPlay","controls","loop","volume","muted","playbackRate","onPlay","onReady","onPause","onEnded","onPlaybackRateChange","loading","setLoading","useState","_error","setError","sourceLoadErrorHandler","useContext","MediaSourceLoadContext","jsxs","Fragment","jsx","Loading","ReactPlayer","AudioWidget","handleUpdateDsl","handleUpdateMultiExecutionResult","displayName","tooltipText","triggerEventHandler","deleteComponentRuntimeProps","updateComponentRuntimeProps","audioRef","useRef","useEffect","isString","time","type","isNumber","_a","value","isBoolean","audio","clampedValue","useCallback","TooltipWrapper"],"mappings":"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"}