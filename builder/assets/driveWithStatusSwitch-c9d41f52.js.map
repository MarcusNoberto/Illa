{"version":3,"file":"driveWithStatusSwitch-c9d41f52.js","sources":["../../src/page/App/components/InspectPanel/PanelSetters/SwitchSetter/driveWithStatusSwitch.tsx"],"sourcesContent":["import { ILLA_MIXPANEL_EVENT_TYPE } from \"@illa-public/mixpanel-utils\"\nimport { debounce } from \"lodash-es\"\nimport { FC, useCallback, useEffect, useMemo, useRef } from \"react\"\nimport { useTranslation } from \"react-i18next\"\nimport { Switch, useModal } from \"@illa-design/react\"\nimport { dynamicWidthStyle } from \"@/page/App/components/InspectPanel/PanelSetters/style\"\nimport { PanelLabel } from \"@/page/App/components/InspectPanel/components/Label\"\nimport {\n  fetchAnonymousPermission,\n  fetchCloseAnonymousPermission,\n  fetchOpenAnonymousPermission,\n} from \"@/services/drive\"\nimport { trackInEditor } from \"@/utils/mixpanelHelper\"\nimport { BaseSwitchProps } from \"./interface\"\nimport { setterContainerStyle } from \"./style\"\n\nconst DriveWithStatusSwitchSetter: FC<BaseSwitchProps> = (props) => {\n  const {\n    value,\n    attrName,\n    handleUpdateDsl,\n    widgetType,\n    handleUpdateMultiAttrDSL,\n    isSetterSingleRow,\n    labelDesc,\n    labelName,\n    labelSize,\n  } = props\n  const anonymousPermission = useRef<boolean>(true)\n  const modal = useModal()\n  const { t } = useTranslation()\n  const switchPermission = useCallback(\n    async (_v: boolean) => {\n      if (_v && !anonymousPermission.current) {\n        modal.show({\n          id: \"switchPermission\",\n          title: t(\n            \"editor.inspect.setter_option.drive_builder.anonymous_modal.title\",\n          ),\n          children: t(\n            \"editor.inspect.setter_option.drive_builder.anonymous_modal.desc\",\n          ),\n          okText: t(\n            \"editor.inspect.setter_option.drive_builder.anonymous_modal.submitBtn\",\n          ),\n          cancelText: t(\n            \"editor.inspect.setter_option.drive_builder.anonymous_modal.cancelBtn\",\n          ),\n          onOk: async () => {\n            try {\n              await fetchOpenAnonymousPermission()\n              anonymousPermission.current = true\n              const updateSlice: Record<string, unknown> = {\n                [attrName]: _v,\n              }\n              if (_v) {\n                updateSlice.ILLADriveFolder = \"\"\n              }\n              handleUpdateMultiAttrDSL?.(updateSlice)\n            } catch (e) {}\n          },\n        })\n      } else if (!_v && anonymousPermission.current) {\n        try {\n          await fetchCloseAnonymousPermission()\n          anonymousPermission.current = false\n          handleUpdateDsl(attrName, _v)\n        } catch (e) {}\n      } else {\n        const updateSlice: Record<string, unknown> = {\n          [attrName]: _v,\n        }\n        if (_v) {\n          updateSlice.ILLADriveFolder = \"\"\n        }\n        handleUpdateMultiAttrDSL?.(updateSlice)\n      }\n    },\n    [attrName, handleUpdateDsl, handleUpdateMultiAttrDSL, modal, t],\n  )\n  const debounceHandleOnSwitch = useMemo(() => {\n    return debounce(async (_v: boolean) => {\n      try {\n        await switchPermission(_v)\n        trackInEditor(ILLA_MIXPANEL_EVENT_TYPE.CLICK, {\n          element: \"component_inspect_radio\",\n          parameter1: widgetType,\n          parameter2: attrName,\n        })\n      } catch (e) {}\n    }, 500)\n  }, [attrName, switchPermission, widgetType])\n\n  useEffect(() => {\n    const request = async () => {\n      try {\n        const res = await fetchAnonymousPermission()\n        anonymousPermission.current = res.data?.anonymous\n      } catch (e) {}\n    }\n    request()\n  }, [attrName])\n\n  return (\n    <div css={setterContainerStyle(isSetterSingleRow)}>\n      <span>\n        {labelName && (\n          <PanelLabel\n            labelName={labelName}\n            labelDesc={labelDesc}\n            labelSize={labelSize}\n          />\n        )}\n      </span>\n      <div css={dynamicWidthStyle}>\n        <Switch\n          onChange={debounceHandleOnSwitch}\n          checked={value}\n          colorScheme=\"techPurple\"\n        />\n      </div>\n    </div>\n  )\n}\n\nDriveWithStatusSwitchSetter.displayName = \"DriveWithStatusSwitchSetter\"\nexport default DriveWithStatusSwitchSetter\n"],"names":["DriveWithStatusSwitchSetter","props","value","attrName","handleUpdateDsl","widgetType","handleUpdateMultiAttrDSL","isSetterSingleRow","labelDesc","labelName","labelSize","anonymousPermission","useRef","modal","useModal","t","useTranslation","switchPermission","useCallback","_v","fetchOpenAnonymousPermission","updateSlice","fetchCloseAnonymousPermission","debounceHandleOnSwitch","useMemo","debounce","trackInEditor","ILLA_MIXPANEL_EVENT_TYPE","useEffect","res","fetchAnonymousPermission","_a","jsxs","setterContainerStyle","jsx","PanelLabel","dynamicWidthStyle","Switch"],"mappings":"kdAgBM,MAAAA,EAAoDC,GAAU,CAC5D,KAAA,CACJ,MAAAC,EACA,SAAAC,EACA,gBAAAC,EACA,WAAAC,EACA,yBAAAC,EACA,kBAAAC,EACA,UAAAC,EACA,UAAAC,EACA,UAAAC,CACE,EAAAT,EACEU,EAAsBC,SAAgB,EAAI,EAC1CC,EAAQC,IACR,CAAE,EAAAC,GAAMC,IACRC,EAAmBC,EAAA,YACvB,MAAOC,GAAgB,CACjB,GAAAA,GAAM,CAACR,EAAoB,QAC7BE,EAAM,KAAK,CACT,GAAI,mBACJ,MAAOE,EACL,kEACF,EACA,SAAUA,EACR,iEACF,EACA,OAAQA,EACN,sEACF,EACA,WAAYA,EACV,sEACF,EACA,KAAM,SAAY,CACZ,GAAA,CACF,MAAMK,EAA6B,EACnCT,EAAoB,QAAU,GAC9B,MAAMU,EAAuC,CAC3C,CAAClB,CAAQ,EAAGgB,CAAA,EAEVA,IACFE,EAAY,gBAAkB,IAEhCf,GAAA,MAAAA,EAA2Be,QACjB,CAAC,CACf,CAAA,CACD,UACQ,CAACF,GAAMR,EAAoB,QAChC,GAAA,CACF,MAAMW,EAA8B,EACpCX,EAAoB,QAAU,GAC9BP,EAAgBD,EAAUgB,CAAE,OAClB,CAAC,KACR,CACL,MAAME,EAAuC,CAC3C,CAAClB,CAAQ,EAAGgB,CAAA,EAEVA,IACFE,EAAY,gBAAkB,IAEhCf,GAAA,MAAAA,EAA2Be,EAC7B,CACF,EACA,CAAClB,EAAUC,EAAiBE,EAA0BO,EAAOE,CAAC,CAAA,EAE1DQ,EAAyBC,EAAAA,QAAQ,IAC9BC,EAAS,MAAON,GAAgB,CACjC,GAAA,CACF,MAAMF,EAAiBE,CAAE,EACzBO,EAAcC,EAAyB,MAAO,CAC5C,QAAS,0BACT,WAAYtB,EACZ,WAAYF,CAAA,CACb,OACS,CAAC,GACZ,GAAG,EACL,CAACA,EAAUc,EAAkBZ,CAAU,CAAC,EAE3CuB,OAAAA,EAAAA,UAAU,IAAM,EACE,SAAY,OACtB,GAAA,CACI,MAAAC,EAAM,MAAMC,IACEnB,EAAA,SAAUoB,EAAAF,EAAI,OAAJ,YAAAE,EAAU,eAC9B,CAAC,CAAA,IAEP,EACP,CAAC5B,CAAQ,CAAC,EAGV6B,EAAA,MAAA,CAAI,IAAKC,EAAqB1B,CAAiB,EAC9C,SAAA,CAAA2B,EAAC,QACE,SACCzB,GAAAyB,EAACC,EAAA,CACC,UAAA1B,EACA,UAAAD,EACA,UAAAE,CAAA,CAAA,EAGN,EACAwB,EAAC,MAAI,CAAA,IAAKE,EACR,SAAAF,EAACG,EAAA,CACC,SAAUd,EACV,QAASrB,EACT,YAAY,YAAA,CAAA,EAEhB,CACF,CAAA,CAAA,CAEJ,EAEAF,EAA4B,YAAc"}