{"version":3,"file":"video-32099ae7.js","sources":["../../src/widgetLibrary/VideoWidget/style.ts","../../src/widgetLibrary/VideoWidget/video.tsx"],"sourcesContent":["import { SerializedStyles, css } from \"@emotion/react\"\nimport { getColor } from \"@illa-design/react\"\n\nexport const fullStyle = css`\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n`\n\nexport const loadingStyle = css`\n  width: 100%;\n  height: 100%;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  background-color: ${getColor(\"gray\", \"01\")};\n  color: ${getColor(\"white\", \"01\")};\n`\n\nexport const applyHiddenStyle = (hidden: boolean): SerializedStyles => {\n  return css`\n    visibility: ${hidden ? \"hidden\" : \"visible\"};\n  `\n}\n","import { isBoolean } from \"lodash-es\"\nimport {\n  FC,\n  forwardRef,\n  useCallback,\n  useContext,\n  useEffect,\n  useRef,\n  useState,\n} from \"react\"\nimport { useTranslation } from \"react-i18next\"\nimport ReactPlayer from \"react-player\"\nimport { Loading, isNumber, isString } from \"@illa-design/react\"\nimport { MediaSourceLoadContext } from \"@/utils/mediaSourceLoad\"\nimport { TooltipWrapper } from \"@/widgetLibrary/PublicSector/TooltipWrapper\"\nimport { fullStyle, loadingStyle } from \"@/widgetLibrary/VideoWidget/style\"\nimport { VideoWidgetProps, WrappedVideoProps } from \"./interface\"\n\nexport const WrappedVideo = forwardRef<ReactPlayer, WrappedVideoProps>(\n  (props, ref) => {\n    const {\n      url,\n      playing,\n      autoPlay,\n      controls = true,\n      loop,\n      volume,\n      muted,\n      playbackRate,\n      onPlay,\n      onReady,\n      onPause,\n      onEnded,\n      onPlaybackRateChange,\n    } = props\n    const { t } = useTranslation()\n    const [loading, setLoading] = useState(true)\n    const [error, setError] = useState(false)\n    const { sourceLoadErrorHandler } = useContext(MediaSourceLoadContext)\n\n    if (url === \"\") {\n      return <div css={loadingStyle}>{t(\"widget.video.empty\")}</div>\n    }\n\n    return (\n      <>\n        {loading ? (\n          <div css={loadingStyle}>\n            <Loading colorScheme=\"white\" />\n          </div>\n        ) : error ? (\n          <div css={loadingStyle}>{t(\"widget.video.fail\")}</div>\n        ) : null}\n        <ReactPlayer\n          style={loading || error ? { display: \"none\" } : undefined}\n          fallback={\n            <div css={loadingStyle}>\n              <Loading colorScheme=\"white\" />\n            </div>\n          }\n          ref={ref}\n          width=\"100%\"\n          height=\"100%\"\n          url={url}\n          volume={volume}\n          muted={muted}\n          controls={controls}\n          playbackRate={playbackRate}\n          loop={loop}\n          playing={autoPlay || playing}\n          draggable={false}\n          onReady={() => {\n            setLoading(false)\n            setError(false)\n            onReady()\n          }}\n          onPlay={onPlay}\n          onPause={onPause}\n          onEnded={onEnded}\n          onError={() => {\n            sourceLoadErrorHandler?.(url, \"VIDEO_WIDGET\")\n            setLoading(false)\n            setError(true)\n          }}\n          onPlaybackRateChange={onPlaybackRateChange}\n        />\n      </>\n    )\n  },\n)\n\nWrappedVideo.displayName = \"WrappedVideo\"\n\nexport const VideoWidget: FC<VideoWidgetProps> = (props) => {\n  const {\n    handleUpdateMultiExecutionResult,\n    updateComponentRuntimeProps,\n    deleteComponentRuntimeProps,\n    displayName,\n    tooltipText,\n    triggerEventHandler,\n    controls,\n  } = props\n\n  const videoRef = useRef<ReactPlayer>(null)\n\n  useEffect(() => {\n    updateComponentRuntimeProps({\n      play: () => {\n        handleUpdateMultiExecutionResult([\n          {\n            displayName,\n            value: { playing: true },\n          },\n        ])\n      },\n      pause: () => {\n        handleUpdateMultiExecutionResult([\n          {\n            displayName,\n            value: { playing: false },\n          },\n        ])\n      },\n      setVideoUrl: (url: string) => {\n        if (!isString(url)) {\n          console.error(\"TypeError: url is not a string\")\n          return\n        }\n        handleUpdateMultiExecutionResult([\n          {\n            displayName,\n            value: { url },\n          },\n        ])\n      },\n      seekTo: (time: number, type: \"seconds\" | \"fraction\" = \"seconds\") => {\n        if (!isNumber(time)) {\n          console.error(\"TypeError: value is not a number\")\n          return\n        }\n        videoRef.current?.seekTo(time, type)\n      },\n      mute: (value: boolean) => {\n        if (!isBoolean(value)) {\n          console.error(\"TypeError: value is not a boolean\")\n          return\n        }\n        handleUpdateMultiExecutionResult([\n          {\n            displayName,\n            value: { muted: value },\n          },\n        ])\n      },\n      showControls: (value: boolean) => {\n        if (!isBoolean(value)) {\n          console.error(\"TypeError: value is not a boolean\")\n          return\n        }\n        handleUpdateMultiExecutionResult([\n          {\n            displayName,\n            value: { controls: value },\n          },\n        ])\n      },\n      setLoop: (value: boolean) => {\n        if (!isBoolean(value)) {\n          console.error(\"TypeError: value is not a boolean\")\n          return\n        }\n        handleUpdateMultiExecutionResult([\n          {\n            displayName,\n            value: { loop: value },\n          },\n        ])\n      },\n      setSpeed: (value: number) => {\n        if (!isNumber(value)) {\n          console.error(\"TypeError: value is not a number\")\n          return\n        }\n        // playbackRate range [0.0625, 16]\n        const clampedValue = Math.max(0.0625, Math.min(16, value))\n        handleUpdateMultiExecutionResult([\n          {\n            displayName,\n            value: { playbackRate: clampedValue },\n          },\n        ])\n      },\n      setVolume: (value: number) => {\n        if (!isNumber(value)) {\n          console.error(\"TypeError: value is not a number\")\n          return\n        }\n        // volume range [0, 1]\n        const clampedValue = Math.max(0, Math.min(1, value))\n        handleUpdateMultiExecutionResult([\n          {\n            displayName,\n            value: { volume: clampedValue },\n          },\n        ])\n      },\n    })\n    return () => {\n      deleteComponentRuntimeProps()\n    }\n  }, [\n    updateComponentRuntimeProps,\n    deleteComponentRuntimeProps,\n    handleUpdateMultiExecutionResult,\n    displayName,\n  ])\n\n  const onPlay = useCallback(() => {\n    handleUpdateMultiExecutionResult([\n      {\n        displayName,\n        value: { playing: true },\n      },\n    ])\n    triggerEventHandler(\"play\")\n  }, [displayName, triggerEventHandler, handleUpdateMultiExecutionResult])\n\n  const onPause = useCallback(() => {\n    handleUpdateMultiExecutionResult([\n      {\n        displayName,\n        value: { playing: false },\n      },\n    ])\n    triggerEventHandler(\"pause\")\n  }, [displayName, triggerEventHandler, handleUpdateMultiExecutionResult])\n\n  const onReady = useCallback(() => {\n    triggerEventHandler(\"loaded\")\n  }, [triggerEventHandler])\n\n  const onEnded = useCallback(() => {\n    triggerEventHandler(\"ended\")\n  }, [triggerEventHandler])\n\n  const onPlaybackRateChange = useCallback(\n    (playbackRate: number) => {\n      if (isNumber(playbackRate)) {\n        handleUpdateMultiExecutionResult([\n          {\n            displayName,\n            value: { playbackRate },\n          },\n        ])\n      }\n    },\n    [displayName, handleUpdateMultiExecutionResult],\n  )\n\n  return (\n    <TooltipWrapper tooltipText={tooltipText} tooltipDisabled={!tooltipText}>\n      <div css={fullStyle}>\n        <WrappedVideo\n          {...props}\n          // controls change need to reload react-player\n          key={Number(controls)}\n          ref={videoRef}\n          onReady={onReady}\n          onPlay={onPlay}\n          onPause={onPause}\n          onEnded={onEnded}\n          onPlaybackRateChange={onPlaybackRateChange}\n        />\n      </div>\n    </TooltipWrapper>\n  )\n}\n\nVideoWidget.displayName = \"VideoWidget\"\nexport default VideoWidget\n"],"names":["fullStyle","css","loadingStyle","getColor","WrappedVideo","forwardRef","props","ref","url","playing","autoPlay","controls","loop","volume","muted","playbackRate","onPlay","onReady","onPause","onEnded","onPlaybackRateChange","t","useTranslation","loading","setLoading","useState","error","setError","sourceLoadErrorHandler","useContext","MediaSourceLoadContext","jsxs","Fragment","jsx","Loading","ReactPlayer","VideoWidget","handleUpdateMultiExecutionResult","updateComponentRuntimeProps","deleteComponentRuntimeProps","displayName","tooltipText","triggerEventHandler","videoRef","useRef","useEffect","isString","time","type","isNumber","_a","value","isBoolean","clampedValue","useCallback","TooltipWrapper","createElement"],"mappings":"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"}