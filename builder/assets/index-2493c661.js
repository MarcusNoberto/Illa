import{k as e,cb as J,cc as ee,n as h,T as D,cd as te,o as u,ce as se,F as $,q as oe,bE as ne,bF as ae,bC as re,bD as ie,cf as ce,aQ as I,aV as le,aa as pe}from"./@illa-design-1f43bb6c.js";import{f5 as W,cU as G,b as a,dN as de,f6 as V,e as M,eZ as R,_ as P,cP as B,a as E,be as z,n as _,B as H,q as x,f7 as ue,f8 as ge,u as F,g as j,f9 as me,d6 as he,l as fe,bB as be,fa as Le,z as ye,fb as Ce,as as N,o as Ie,p as Ae,s as Ee,fc as O,fd as Pe,fe as we,aq as A,ff as Te,fg as Se,bm as Be,t as De,E as S,a3 as Me,a4 as U,W as Re,x as L}from"./index-4dce6ee8.js";import{r,u as v,m as K,o as _e}from"./react-9b7e00e3.js";import{s as xe,b as ve,h as ke,e as Ne,j as Oe,c as Ue,m as $e,f as We,k as Ge,o as Ve,p as ze,w as He}from"./style-51b259bb.js";import{M as Fe,D as je,P as Ke,A as Xe,a as qe,C as Ye,S as Qe,b as Ze}from"./index-cd7c17cc.js";import{s as Je,a as et,b as tt,C as st}from"./layoutInfoListener-bd63c738.js";import{a as ot}from"./index-a95bdaa9.js";import{u as nt}from"./hook-302a78fc.js";import{a as f}from"./@emotion-08a6282b.js";import{p as at}from"./renderComponentCanvasContainer-2e4cd54a.js";import"./codeMirror-vendor-320207e2.js";import"./lodash-lib-6e94956b.js";import"./react-icons-vendor-2430ea65.js";import"./index-03ca7e7b.js";import"./index-6f32d056.js";import"./index-5be17f9b.js";import"./clsx.m-925abe8b.js";import"./clsx.m-266f4de0.js";import"./index-934389e2.js";import"./style-af69883e.js";import"./index-2fdfc937.js";import"./drive-584d85d3.js";import"./objectWithoutPropertiesLoose-4f48578a.js";import"./popper-a04e2b11.js";import"./objectWithoutPropertiesLoose-e3246981.js";import"./clsx-06f54762.js";import"./style-49f23046.js";import"./index-d48f7e94.js";import"./index-cf2bb556.js";const rt=async(s,n)=>await W({url:`/room/websocketConnection/app/${s}`,method:"GET",signal:n},{teamID:G()}),it=async(s,n)=>await W({url:`/room/binaryWebsocketConnection/app/${s}`,method:"GET",signal:n},{teamID:G()}),ct=()=>{const s=a(de),n=a(V),t=r.useMemo(()=>{if(s){let l=0;return Object.keys(s).forEach(p=>{Array.isArray(s[p])&&(l+=s[p].length)}),l}},[s]),c=M(),i=()=>{B(E.CLICK,{element:"debug",parameter2:t??0}),c(z.updateDebuggerVisible(!n))};return e(D,{position:"right",content:R("flow.editor.app.tooltips.debug"),children:e(P,{onClick:i,children:e(J,{count:t,children:e(ee,{color:h("grayBlue","02")})})})})},lt=r.memo(ct),pt=()=>{var o,d;const{teamIdentifier:s,appId:n}=v(),t=a(_),c=K(),i=nt(),l=H(t==null?void 0:t.myRole,x(t),(o=t==null?void 0:t.totalTeamLicense)==null?void 0:o.teamLicensePurchased,(d=t==null?void 0:t.totalTeamLicense)==null?void 0:d.teamLicenseAllPaid),p=()=>{l?c(`/${s}/appHistory/${n}`):i({modalType:"upgrade",from:"app_edit_more_history"})};return e(D,{position:"right",content:R("flow.editor.app.tooltips.edit_history"),children:e(P,{onClick:p,children:e(te,{color:h("grayBlue","02")})})})},dt=r.memo(pt),ut=()=>{const s=a(ue),[n,t]=r.useState(s),[c,i]=r.useState(!1);r.useEffect(()=>{t(s)},[s]);const l=()=>{t(!0)},p=o=>{o?t(!0):(t(!1),i(!0),setTimeout(()=>{i(!1)},1500))};return s&&u($,{children:[e(D,{content:R("flow.editor.flow.tooltips.missing_resources"),position:"right",popupVisible:c,onVisibleChange:i,children:e(P,{onClick:l,children:e(se,{color:h("orange","03")})})}),e(Fe,{shown:n,changeShown:p})]})},gt=r.memo(ut),X=f`
  display: flex;
  flex-direction: row;
  align-items: center;
`;f`
  ${X};
  justify-content: space-between;
  gap: 8px;
`;f`
  color: ${h("grayBlue","04")};
  font-size: 14px;
  font-weight: 400;
  line-height: 22px;
  text-transform: capitalize;
`;f`
  ${X};
  gap: 8px;
`;const mt=128,q=" Copy",ht=mt-q.length,ft=(s,n)=>{const t=`${(n||"").slice(0,ht)}${q}`;return ge(s,t)},bt=()=>{var b,y;const{teamIdentifier:s,appId:n}=v(),[t,c]=r.useState(!1),{t:i}=F(),l=K();M();const p=a(j),o=a(_);a(me);const d=oe();H(o==null?void 0:o.myRole,x(o),(b=o==null?void 0:o.totalTeamLicense)==null?void 0:b.teamLicensePurchased,(y=o==null?void 0:o.totalTeamLicense)==null?void 0:y.teamLicenseAllPaid);const w=m=>{m&&B(E.SHOW,{element:"app_duplicate",parameter5:n})},T=async()=>{if(B(E.CLICK,{element:"app_duplicate",parameter5:n}),!t){c(!0);try{const m=await ft(p.appId,p.appName);l(`/${s}/app/${m.data.appId}`)}catch(m){fe(m)?d.error({content:i("dashboard.app.duplicate_fail")}):d.error({content:i("network_error")})}finally{c(!1)}}};return e(ie,{position:"bottom-end",trigger:"click",triggerProps:{closeDelay:0,openDelay:0},onVisibleChange:w,dropList:u(ae,{children:[e(ne,{value:"duplicate",title:i("duplicate"),onClick:T},"duplicate"),he]}),children:e(P,{children:e(re,{color:h("grayBlue","02")})})})},Lt=r.memo(bt),yt=f`
  display: flex;
  flex-direction: column;
  height: 100%;
  border-right: 1px solid ${h("grayBlue","08")};
  background-color: white;
  padding: 12px;
  gap: 24px;
`,Ct=()=>{const s=a(be);return u("div",{css:yt,children:[e(gt,{}),e(lt,{}),!s&&e(dt,{}),!s&&e(Lt,{})]})},It=r.memo(Ct),At=f`
  display: flex;
  height: 100%;
  flex: none;
`,Et=()=>{const s=a(Le);return u("div",{css:At,children:[e(It,{}),s&&e(je,{})]})},Pt=r.memo(Et),wt=()=>{const s=M(),{t:n}=F(),{appId:t}=v(),c=ce(),i=a(ye),l=a(_),p=a(Ce),o=l==null?void 0:l.myRole,d=r.useCallback(()=>{N.leaveRoom("app",t??"")},[t]);if(o&&!Ie(o,Ee.APP,x(l),Ae.EDIT_APP))throw new Error("You don't have permission to edit this app");r.useEffect(()=>{const g=new AbortController;return i!=null&&i.userID!=""&&t&&(Promise.all([rt(t,g.signal),it(t,g.signal)]).then(C=>{N.enterAppRoom(O(C[0].data.wsURL),O(C[1].data.wsURL),t)}).catch(()=>{}),window.addEventListener("beforeunload",d)),()=>{g.abort(),d(),s(Pe.setInRoomUsers({inRoomUsers:[]})),s(z.updateWSStatusReducer({context:we.APP,wsStatus:A.CLOSED})),window.removeEventListener("beforeunload",d)}},[i,t,d,s]),r.useEffect(()=>{const g=[Je(L),et(L),tt(L),xe(L),ve(L)];return()=>g.forEach(C=>C())},[]);const w=a(Te),T=a(Se),b=a(V),y=a(Be),{loadingState:m}=ke("edit"),Y=r.useCallback(g=>{g.stopPropagation(),c.start({scale:1.05,transition:{duration:.2}}).then(()=>{c.start({scale:1,transition:{duration:.2}})})},[c]);r.useEffect(()=>(De(E.VISIT,S.EDITOR),Me(),()=>{U(S.EDITOR)}),[]),_e(()=>{U(S.EDITOR)});const[,Q]=at(),Z=a(j),k=m||p===A.INIT||p===A.CONNECTING;return u($,{children:[e(Re,{children:e("title",{children:Z.appName})}),u("div",{css:Ne,ref:Q,children:[k&&e(Ze,{}),!k&&e(Qe,{children:u(ot,{children:[e(I,{renderInBody:!0,zIndex:10,children:e(Ke,{css:Oe})}),u("div",{css:Ue,children:[e(Pt,{}),u("div",{css:$e,children:[e(I,{renderInBody:!0,zIndex:10,children:e(st,{css:We})}),e(I,{renderInBody:!0,zIndex:10,children:T&&!b?e(Xe,{}):null}),b&&e(qe,{css:Ge})]}),w&&e(I,{renderInBody:!0,zIndex:10,children:e(Ye,{})})]}),!y&&e("div",{css:Ve,onMouseDown:Y,children:u(le.div,{css:ze,animate:c,children:[e(pe,{css:He}),p===A.LOCKING?n("editor.history.message.version_change"):n("not_online_tips")]})})]})})]})]})};wt.displayName="Editor";export{wt as Editor,wt as default};
//# sourceMappingURL=index-2493c661.js.map
